# 1 é™„ä»¶ä¸‹è½½

é¦–å…ˆæ¥çœ‹é™„ä»¶è¡¨ï¼Œè¯¥è¡¨ç”¨äºå­˜å‚¨é™„ä»¶çš„ç›¸å…³ä¿¡æ¯ã€‚å…¶ä¸­ä¸€ä¸ªå…³é”®å­—æ®µ`filepath`è¡¨ç¤ºé™„ä»¶åœ¨æœåŠ¡å™¨ä¸Šçš„å­˜å‚¨è·¯å¾„ï¼š

![image-20250116114417915](assets/image-20250116114417915.png)

ä¸‹è½½çš„æ ¸å¿ƒå°±æ˜¯é€šè¿‡`filepath`å­—æ®µæ ‡è¯†çš„è·¯å¾„è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†å…¶å“åº”ç»™å®¢æˆ·ç«¯ã€‚

åœ¨æ­¤åŸºç¡€ä¸Šï¼Œä¸‹è½½é™„ä»¶çš„ä¸šåŠ¡é€»è¾‘è¿˜æ¶‰åŠä»¥ä¸‹éœ€æ±‚ï¼š

- **ç§¯åˆ†æœºåˆ¶**ï¼šæ™®é€šç”¨æˆ·ä¸‹è½½é™„ä»¶éœ€è¦æ¶ˆè€—å…¶è´¦æˆ·ä¸­çš„ç§¯åˆ†ï¼ŒåŒæ—¶é™„ä»¶çš„ä½œè€…å°†ç›¸åº”å¢åŠ ç§¯åˆ†æ”¶ç›Šã€‚
- **ä½œè€…ç‰¹æƒ**ï¼šé™„ä»¶çš„ä½œè€…å¯ç›´æ¥ä¸‹è½½è‡ªå·±çš„é™„ä»¶ï¼Œæ— éœ€ç§¯åˆ†æ¶ˆè€—ã€‚
- **æƒé™æ§åˆ¶**ï¼šä¸‹è½½é™„ä»¶çš„æ¥å£éœ€æ ¡éªŒç”¨æˆ·çš„ç™»å½•çŠ¶æ€ï¼Œç¡®ä¿ä»…ç™»å½•ç”¨æˆ·å¯è¿›è¡Œæ“ä½œã€‚
- **é‡å¤ä¸‹è½½ä¼˜åŒ–**ï¼šå¦‚æœç”¨æˆ·å·²ç»ä¸‹è½½è¿‡æŸé™„ä»¶ï¼Œå†æ¬¡ä¸‹è½½æ—¶æ— éœ€æ¶ˆè€—ç§¯åˆ†ã€‚
- **è¡Œä¸ºè®°å½•**ï¼šä¸‹è½½é™„ä»¶çš„æ“ä½œä¼šç”Ÿæˆä¸€æ¡æ¶ˆæ¯é€šçŸ¥å‘é€ç»™é™„ä»¶çš„ä½œè€…ã€‚ä½†éœ€è¦æ³¨æ„ï¼Œä½œè€…æœ¬äººä¸‹è½½è‡ªå·±çš„é™„ä»¶ä¸ä¼šè§¦å‘æ¶ˆæ¯è®°å½•ã€‚

---

## 1.1 ä¸‹è½½è®°å½•è¡¨

ä¸ºå®ç°"é‡å¤ä¸‹è½½ä¸æ¶ˆè€—ç§¯åˆ†"çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬éœ€è¦ä¸“é—¨è®¾è®¡ä¸€å¼ çš„è¡¨ï¼Œç”¨äºè®°å½•ç”¨æˆ·çš„ä¸‹è½½è¡Œä¸ºã€‚

å…·ä½“æ¥è¯´ï¼Œå½“ç”¨æˆ·é¦–æ¬¡ä¸‹è½½é™„ä»¶æ—¶ï¼Œå°†å…¶ä¸‹è½½è®°å½•å­˜å‚¨åˆ°è¯¥è¡¨ä¸­ã€‚éšåï¼Œæ¯æ¬¡ç”¨æˆ·å°è¯•ä¸‹è½½ç›¸åŒé™„ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡æŸ¥è¯¢è¯¥è¡¨åˆ¤æ–­è¯¥ç”¨æˆ·æ˜¯å¦å·²æœ‰ç›¸å…³è®°å½•ã€‚å¦‚æœè®°å½•å·²å­˜åœ¨ï¼Œç”¨æˆ·ä¸æ˜¯é¦–æ¬¡ä¸‹è½½ï¼Œä»è€Œå…é™¤ç§¯åˆ†æ¶ˆè€—ã€‚

è¡¨ç»“æ„å¦‚ä¸‹ï¼š

```sql
create table attachment_download_recode
(
    download_recode_id int auto_increment comment 'ä¸‹è½½è®°å½•id'
        primary key,
    article_id         varchar(15) not null comment 'æ–‡ç« id',
    downloader_id      varchar(15) not null comment 'ä¸‹è½½äººid',
    download_time      datetime    not null comment 'ä¸‹è½½æ—¶é—´',
    constraint attachment_download_recode_pk
        unique (article_id, downloader_id)
)
    comment 'é™„ä»¶ä¸‹è½½è®°å½•è¡¨';
```

å› ä¸ºé™„ä»¶ä¸æ–‡å­—ç»‘å®šåœ¨ä¸€èµ·ï¼Œå¹¶ä¸”ä¸€ç¯‡æ–‡ç« å¯èƒ½åŒ…å«å¤šä¸ªé™„ä»¶ï¼Œå› æ­¤ä¸‹è½½è®°å½•è¡¨ä¸­æˆ‘å¹¶æ²¡æœ‰è®°å½•æ–‡ä»¶idï¼Œè€Œæ˜¯è®°å½•æ–‡ç« idã€‚

---

## 1.2 ğŸŒä¸‹è½½é™„ä»¶æ¥å£

åœ°å€ï¼š

```
http://localhost:8091/web/articles/attachment
```

è¯·æ±‚æ–¹å¼ï¼š

`GET`

è¯·æ±‚å‚æ•°ï¼š

| å‚æ•°å     | ç±»å‹     | å¿…å¡«é¡¹ | è¯´æ˜         |
| ---------- | -------- | ------ | ------------ |
| articleId  | `string` | `true` | æ–‡ç« id       |
| title      | `string` | `true` | æ–‡ç« æ ‡é¢˜     |
| authorId   | `string` | `true` | ä½œè€…id       |
| needPoints | `int`    | `true` | ä¸‹è½½æ‰€éœ€ç§¯åˆ† |

å“åº”ï¼š

```
æ•°æ®æµ
```

---

## 1.3 æ¥å£å®ç°

ä¸šåŠ¡å±‚ä¸»è¦è´Ÿè´£ç”¨æˆ·ç§¯åˆ†çš„æ›´æ–°ã€ç§¯åˆ†è®°å½•ã€ä¸‹è½½è®°å½•ã€æ¶ˆæ¯è®°å½•ç­‰ç›¸å…³æ“ä½œï¼Œæœ€ç»ˆè¿”å›é™„ä»¶åˆ—è¡¨ã€‚å®é™…çš„æ–‡ä»¶ä¸‹è½½æ“ä½œç”±æ§åˆ¶å™¨å±‚å®Œæˆã€‚

ç§¯åˆ†æ“ä½œçš„æ–¹æ³•ï¼Œå·²åœ¨æ³¨å†Œæ¥å£ä¸­è¯¦ç»†è¯´æ˜ï¼Œè§[9.ç§¯åˆ†è¡¨ä»¥åŠå¯¹åº”CRUD.md](9.ç§¯åˆ†è¡¨ä»¥åŠå¯¹åº”CRUD.md)ã€‚å½“æ—¶è€ƒè™‘åˆ°å…¶ä»–æ¥å£å¯èƒ½ä¹Ÿéœ€è¦æ‰§è¡Œç§¯åˆ†ç›¸å…³æ“ä½œå› æ­¤ä¸“é—¨æŠ½ç¦»å‡ºä¸€ä¸ªå¤„ç†ç§¯åˆ†çš„æ–¹æ³•ï¼š`processUserPoints()`ï¼Œè¿™é‡Œç›´æ¥è°ƒç”¨ã€‚è¯¥æ–¹æ³•çš„ä¸»è¦èŒè´£åŒ…æ‹¬ä¸¤ä¸ªæ–¹é¢ï¼šæ›´æ–°ç”¨æˆ·çš„ç§¯åˆ†ä»¥åŠè®°å½•ç”¨æˆ·çš„ç§¯åˆ†æ›´æ–°æƒ…å†µã€‚

é‰´äºä¸‹è½½æ“ä½œæ¶‰åŠä¸‹è½½äººå’Œä½œè€…åŒæ–¹çš„ç§¯åˆ†æ›´æ–°ï¼Œå› æ­¤`processUserPoints()`éœ€è¦è°ƒç”¨ä¸¤æ¬¡ã€‚

åœ¨æ‰§è¡Œç§¯åˆ†æ›´æ–°å‰ï¼Œé¦–å…ˆéœ€è¦æŸ¥è¯¢ä¸‹è½½è®°å½•è¡¨ã€‚å¦‚æœè®°å½•ä¸å­˜åœ¨ï¼Œè¯´æ˜è¿™æ˜¯ç”¨æˆ·çš„é¦–æ¬¡ä¸‹è½½ï¼Œæ­¤æ—¶ä¼šè¿›è¡Œç§¯åˆ†æ›´æ–°æ“ä½œï¼›è‹¥è®°å½•å·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å›é™„ä»¶åˆ—è¡¨ï¼Œè·³è¿‡ç§¯åˆ†æ›´æ–°æ­¥éª¤ï¼Œè¿›è¡Œæ–‡ä»¶ä¸‹è½½ã€‚

ä»¥ä¸‹æ˜¯ä¸šåŠ¡æ¥å£ï¼š

```java
/**
     * å¤„ç†æ–‡ç« é™„ä»¶ä¸‹è½½ä¸­ç§¯åˆ†æƒ…å†µè®°å½•&æ¶ˆæ¯è®°å½•
     *
     * @param userinfo
     * @param articleId
     * @param title
     * @param authorId
     * @param needPoints
     * @return
     */
    List<Attachment> processAttachmentDownload(UserInfoSessionDto userinfo, String articleId, String title, String authorId, Integer needPoints);
```

å…·ä½“å®ç°ï¼š

```java
/**
     * æ–‡ç« é™„ä»¶ä¸‹è½½
     *
     * @param session
     * @param response
     * @param articleId
     * @param title
     * @param authorId
     * @param needPoints
     */
    @GetMapping("/attachment")
    @AccessControl(loginRequired = true)
    @Transactional(rollbackFor = Exception.class)
    public void attachmentDownload(HttpSession session, HttpServletResponse response,
                                   @Validation(max = 15) String articleId, @Validation String title,
                                   @Validation(max = 15) String authorId, @Validation Integer needPoints) {
        UserInfoSessionDto userInfo = (UserInfoSessionDto) session.getAttribute(Constant.USERINFO_SESSION_KEY);
        List<Attachment> attachments = articleService.processAttachmentDownload(userInfo, articleId, title, authorId, needPoints);
        try {
            if (attachments.size() > 1) {
                downloadAsZip(response, attachments);           // å‹ç¼©ä¸‹è½½
            } else {
                downloadAsOne(response, attachments.get(0));    // å•æ–‡ä»¶ä¸‹è½½
            }
        } catch (BusinessException e) {
            throw e;
        } catch (Exception e) {
            throw new BusinessException(CommonMsg.FILE_DOWNLOAD_FAIL, e);
        }
    }

    /**
     * å•æ–‡ä»¶ç›´æ¥ä¸‹è½½
     *
     * @param response
     * @param attachment
     * @throws IOException
     */
    private void downloadAsOne(HttpServletResponse response, Attachment attachment) throws IOException {
        response.setContentType(MIMETypeEnum.getContentType(attachment.getFiletype()));
        response.setHeader("Content-Disposition", "attachment; filename=" + attachment.getFilename());
        response.setContentLengthLong(attachment.getFileSize());
        try (OutputStream os = response.getOutputStream();
             InputStream is = new FileInputStream(toServerPath(attachment.getFilepath()))) {
            byte[] buffer = new byte[8192];
            int len;
            while ((len = is.read(buffer)) != -1) {
                os.write(buffer, 0, len);
            }
        } catch (IOException e) {
            throw e;
        }
    }

    /**
     * å¤šæ–‡ä»¶å‹ç¼©ä¸‹è½½
     *
     * @param response
     * @param attachments
     * @throws IOException
     */
    private void downloadAsZip(HttpServletResponse response, List<Attachment> attachments) throws IOException {
        response.setContentType(MIMETypeEnum.ZIP.getContentType());
        String filename = URLEncoder.encode(String.format(Constant.ZIP_FILENAME, StrUtil.formatDate("_yyyyMMdd_hhmmss")));
        response.setHeader("Content-Disposition", "attachment; filename=" + filename);
        response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
        try (OutputStream os = response.getOutputStream();
             ZipOutputStream zos = new ZipOutputStream(os)) {
            for (Attachment attachment : attachments) {
                File file = new File(toServerPath(attachment.getFilepath()));
                ZipEntry zipEntry = new ZipEntry(attachment.getFilename());
                zos.putNextEntry(zipEntry);
                try (InputStream is = new FileInputStream(file)) {
                    byte[] buffer = new byte[8192];
                    int len;
                    while ((len = is.read(buffer)) != -1) {
                        zos.write(buffer, 0, len);
                    }
                    zos.closeEntry();
                }
            }
            zos.flush();
        } catch (IOException e) {
            throw e;
        }
    }

    /**
     * æ‹¼æ¥ä¸ºæœåŠ¡å™¨ç»å¯¹è·¯å¾„
     *
     * @param res
     * @return
     */
    private String toServerPath(String res) {
        return new StringBuffer()
                .append(webConfig.getProjectFolder())
                .append(File.separator)
                .append(webConfig.getProjectFolderAttachment())
                .append(res).toString();
    }
```

æ§åˆ¶å™¨å±‚ï¼š

```java
/**
     * æ–‡ç« é™„ä»¶ä¸‹è½½
     *
     * @param session
     * @param response
     * @param articleId
     * @param title
     * @param authorId
     * @param needPoints
     */
    @GetMapping("/attachment")
    @AccessControl(loginRequired = true)
    @Transactional(rollbackFor = Exception.class)
    public void attachmentDownload(HttpSession session, HttpServletResponse response,
                                   @Validation(max = 15) String articleId, @Validation String title,
                                   @Validation(max = 15) String authorId, @Validation Integer needPoints) {
        UserInfoSessionDto userInfo = (UserInfoSessionDto) session.getAttribute(Constant.USERINFO_SESSION_KEY);
        List<Attachment> attachments = articleService.processAttachmentDownload(userInfo, articleId, title, authorId, needPoints);
        try {
            if (attachments.size() > 1) {
                downloadAsZip(response, attachments);           // å‹ç¼©ä¸‹è½½
            } else {
                downloadAsOne(response, attachments.get(0));    // å•æ–‡ä»¶ä¸‹è½½
            }
        } catch (BusinessException e) {
            throw e;
        } catch (Exception e) {
            throw new BusinessException(CommonMsg.FILE_DOWNLOAD_FAIL, e);
        }
    }

    /**
     * å•æ–‡ä»¶ç›´æ¥ä¸‹è½½
     *
     * @param response
     * @param attachment
     * @throws IOException
     */
    private void downloadAsOne(HttpServletResponse response, Attachment attachment) throws IOException {
        response.setContentType(MIMETypeEnum.getContentType(attachment.getFiletype()));
        response.setHeader("Content-Disposition", "attachment; filename=" + attachment.getFilename());
        response.setContentLengthLong(attachment.getFileSize());
        try (OutputStream os = response.getOutputStream();
             InputStream is = new FileInputStream(attachment.getFilepath())) {
            byte[] buffer = new byte[8192];
            int len;
            while ((len = is.read(buffer)) != -1) {
                os.write(buffer, 0, len);
            }
        } catch (IOException e) {
            throw e;
        }
    }

    /**
     * å¤šæ–‡ä»¶å‹ç¼©ä¸‹è½½
     *
     * @param response
     * @param attachments
     * @throws IOException
     */
    private void downloadAsZip(HttpServletResponse response, List<Attachment> attachments) throws IOException {
        response.setContentType(MIMETypeEnum.ZIP.getContentType());
        response.setHeader("Content-Disposition", "attachment; filename=attachment.zip");
        response.setHeader("Cache-Control", "no-cache, no-store, must-revalidate");
        try (OutputStream os = response.getOutputStream();
             ZipOutputStream zos = new ZipOutputStream(os)) {
            for (Attachment attachment : attachments) {
                File file = new File(attachment.getFilepath());
                ZipEntry zipEntry = new ZipEntry(attachment.getFilename());
                zos.putNextEntry(zipEntry);
                try (InputStream is = new FileInputStream(file)) {
                    byte[] buffer = new byte[8192];
                    int len;
                    while ((len = is.read(buffer)) != -1) {
                        zos.write(buffer, 0, len);
                    }
                    zos.closeEntry();
                }
            }
            zos.flush();
        } catch (IOException e) {
            throw e;
        }
    }
```

## 1.4 å‹ç¼©ä¸‹è½½

è¿™é‡Œç€é‡æä¸€ä¸‹å‹ç¼©ä¸‹è½½ï¼Œæˆ‘ä»¬éƒ½çŸ¥é“HTTP è¯·æ±‚å’Œå“åº”éµå¾ª"ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”"çš„åŸåˆ™ã€‚å½“ä¸€ä¸ªæ–‡ç« åŒ…å«å¤šä¸ªé™„ä»¶æ—¶ï¼Œå¦‚æœæ¯ä¸ªé™„ä»¶éƒ½å•ç‹¬å“åº”ï¼Œå°±ä¼šå¯¼è‡´ä¸€æ¬¡è¯·æ±‚å‘èµ·å¤šä¸ªå“åº”ã€‚ç„¶è€Œï¼Œæµè§ˆå™¨åªä¼šéµå¾ª"ä¸€æ¬¡è¯·æ±‚ï¼Œä¸€æ¬¡å“åº”"çš„åŸåˆ™ï¼Œè¿™æ„å‘³ç€åªæœ‰ç¬¬ä¸€ä¸ªæ–‡ä»¶ä¼šè¢«ä¸‹è½½ï¼Œåç»­çš„é™„ä»¶æ— æ³•å®Œæˆä¸‹è½½ã€‚

ä¸ºäº†å®ç°ä¸€æ¬¡æ€§ä¸‹è½½å¤šä¸ªé™„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å°†è¿™äº›é™„ä»¶æ‰“åŒ…æˆä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œå¹¶é€šè¿‡è¯¥å‹ç¼©æ–‡ä»¶è¿›è¡Œå“åº”ã€‚

åœ¨å®ç°å‹ç¼©ä¸‹è½½æ—¶ï¼Œä¸»è¦æ¶‰åŠåˆ°ä¸¤ä¸ªç±»ï¼š`ZipOutputStream`å’Œ`ZipEntry`ã€‚ä»¥ä¸‹æ˜¯å®ç°çš„åŸºæœ¬æ­¥éª¤ï¼š

1ã€é€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä½¿ç”¨æ™®é€šçš„è¾“å‡ºæµæ¥å†™å‡ºæ–‡ä»¶å†…å®¹ï¼Œä½†åœ¨è¿›è¡Œå‹ç¼©å†™å…¥æ—¶ï¼Œéœ€è¦ä½¿ç”¨å‹ç¼©è¾“å‡ºæµã€‚å› æ­¤ï¼Œæˆ‘ä»¬é¦–å…ˆå°†è¾“å‡ºæµåŒ…è£…ä¸ºå‹ç¼©è¾“å‡ºæµï¼š

```java
new ZipOutputStream(OutputStream)//é€šè¿‡æ„é€ 
```

2ã€æ–‡ä»¶åè¦åŒ…è£…ä¸ºå‹ç¼©æ¡ç›®(`ZipEntry`)ï¼Œç„¶åæ”¾åˆ°å‹ç¼©è¾“å‡ºæµä¸­ï¼Œå…·ä½“åšæ³•æ˜¯éå†æ–‡ä»¶åˆ—è¡¨ï¼š

æ¯ä¸ªæ–‡ä»¶éœ€è¦è¢«åŒ…è£…æˆä¸€ä¸ªå‹ç¼©æ¡ç›®(`ZipEntry`)ï¼Œç„¶åå°†è¿™äº›æ¡ç›®ä¾æ¬¡æ”¾å…¥å‹ç¼©è¾“å‡ºæµä¸­ã€‚å…·ä½“æ–¹æ³•æ˜¯éå†æ–‡ä»¶åˆ—è¡¨å¹¶ä¸ºæ¯ä¸ªæ–‡ä»¶åˆ›å»ºä¸€ä¸ª `ZipEntry`ï¼Œç„¶åå°†å…¶æ·»åŠ åˆ°ä¸­`ZipOutputStream`ï¼š

```java
ZipOutputStream zos = new ZipOutputStream(OutputStream)// å‹ç¼©è¾“å‡ºæµ
for(File file : files) {
    // æ„å»ºå‹ç¼©æ¡ç›®
    ZipEntry zipEntry = new ZipEntry(file.getName());
    zos.putNextEntry()// æ”¾åˆ°å‹ç¼©è¾“å‡ºæµä¸­
}
```

3ã€è¯»å–æ–‡ä»¶å†…å®¹ï¼Œç„¶åå†™å…¥åˆ°å‹ç¼©è¾“å‡ºæµä¸­ï¼š

```java
InputStream is = new FileInputStream(file)) {
byte[] buffer = new byte[8192];
int len;
while ((len = is.read(buffer)) != -1) {
	zos.write(buffer, 0, len);
}

```

4ã€åœ¨æ¯ä¸ªæ–‡ä»¶å†™å…¥å®Œæ¯•åï¼Œè°ƒç”¨`closeEntry()`å…³é—­å½“å‰çš„å‹ç¼©æ¡ç›®ï¼š

```java
while ((len = is.read(buffer)) != -1) {
	zos.write(buffer, 0, len);
}
zos.closeEntry();
```

5ã€æœ€åå…³é—­æµå¹¶å°†æ•°æ®åˆ·å‡ºï¼š

```java
for(File file : files) {
    ...
    while ((len = is.read(buffer)) != -1) {
		zos.write(buffer, 0, len);
	}
}
zos.flush();
```

å…³é—­æµå’Œåˆ·æ–°æ•°æ®æ˜¯éå¸¸é‡è¦çš„æ­¥éª¤ï¼Œä»¥ç¡®ä¿å‹ç¼©æ–‡ä»¶çš„å®Œæ•´

---

## 1.5 ä¸‹è½½å¤±è´¥æ— æ³•å“åº”é”™è¯¯ 

å½“å‰çš„æ–‡ä»¶ä¸‹è½½å®ç°å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œç³»ç»Ÿæ— æ³•æ­£ç¡®å“åº”é”™è¯¯çš„ JSON æ ¼å¼ï¼ŒåŒæ—¶è¿˜ä¼šä¸‹è½½ä¸€ä¸ªç©ºçš„é”™è¯¯æ–‡ä»¶ã€‚ç†æƒ³çš„åœºæ™¯åº”æ˜¯ï¼šå½“ä¸‹è½½è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯æ—¶ï¼Œä¸‹è½½ç«‹å³ç»ˆæ­¢ï¼Œå¹¶è¿”å›ä¸€ä¸ªé”™è¯¯çš„ JSON å“åº”ã€‚

**å¼‚å¸¸æ¨¡æ‹Ÿè¿‡ç¨‹**ï¼š

é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡ä¿®æ”¹é™„ä»¶è¡¨ä¸­æ–‡ä»¶çš„è·¯å¾„æ¥æ¨¡æ‹Ÿå¼‚å¸¸ï¼š

![image-20250117134503482](assets/image-20250117134503482.png)

æ¥ç€å‘èµ·ä¸‹è½½ï¼Œä¸‹è½½ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š

![image-20250117135545183](assets/image-20250117135545183.png)

æ‰“å¼€ä¸‹è½½çš„æ–‡ä»¶ï¼Œå‘ç°æ–‡ä»¶å†…å®¹ä¸ºç©ºï¼š

![image-20250117135620276](assets/image-20250117135620276.png)

ç”±äºæ–‡ä»¶è·¯å¾„å·²è¢«ä¿®æ”¹ä¸”è·¯å¾„ä¸å­˜åœ¨ï¼Œå› æ­¤åœ¨åˆ›å»ºæ–‡ä»¶å¯¹è±¡æ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š

![image-20250117135729310](assets/image-20250117135729310.png)

è¯¥å¼‚å¸¸æœ€ç»ˆè¢«å…¨å±€å¼‚å¸¸æ‹¦æˆªå™¨æ•è·ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œç³»ç»Ÿåº”è¿”å›ä¸€ä¸ªå¸¦æœ‰é”™è¯¯ä¿¡æ¯çš„ JSON å“åº”ï¼ˆå¦‚`Result`å¯¹è±¡ï¼‰ï¼Œä½†ç”±äºå“åº”å¤´ä¸­è®¾ç½®äº† `Content-Type` ä¸º `application/zip`ï¼Œæµè§ˆå™¨è¯¯è®¤ä¸ºè¯¥å“åº”ä¸ºå‹ç¼©æ–‡ä»¶ç±»å‹ï¼Œå› æ­¤ä¼šå°†å…¶å“åº”çš„å†…å®¹ä½œä¸ºå‹ç¼©æ–‡ä»¶è¿›è¡Œè§£æã€‚åŒæ—¶ï¼Œæˆ‘ä»¬è¿˜è®¾ç½®äº† `Content-Disposition` ä¸º `attachment`ï¼Œä½¿å¾—æµè§ˆå™¨å°†è¯¥å“åº”è§†ä¸ºé™„ä»¶è¿›è¡Œä¸‹è½½ã€‚è¿™æ ·ï¼Œå°½ç®¡å‘ç”Ÿäº†é”™è¯¯ï¼Œæµè§ˆå™¨ä»ç„¶ä¼šä¸‹è½½æ–‡ä»¶ï¼Œä¸”ç”±äºè§£æé”™è¯¯ï¼Œä¸‹è½½çš„æ–‡ä»¶ä¸ºç©ºã€‚

![image-20250117140211297](assets/image-20250117140211297.png)

åœ¨æ‹¦æˆªå™¨å“åº”æ—¥å¿—ä¸­ï¼Œå¯ä»¥çœ‹åˆ°ï¼š

```
Found 'Content-Type:application/zip' in response
```

![image-20250117135910316](assets/image-20250117135910316.png)

è¿™è¡¨ç¤ºå“åº”å¤´ä¸­çš„ `Content-Type` è¢«è®¾ç½®ä¸º `application/zip`ã€‚

**å°è¯•ä¿®å¤å“åº”å¤´**ï¼š

è€ƒè™‘åˆ°æ˜¯å“åº”å¤´å¯¼è‡´äº†æµè§ˆå™¨é”™è¯¯çš„å¤„ç†æ–¹å¼ï¼Œæˆ‘ä»¬å°è¯•åœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œé‡æ–°è®¾ç½®å“åº”å¤´ä¸º `application/json`ã€‚åœ¨è¿›è¡Œæ­¤æ“ä½œæ—¶ï¼Œæˆ‘ä»¬å…ˆå°†å“åº”å¤´æ¸…ç©ºï¼Œç„¶åè®¾ç½®æ–°çš„å“åº”å¤´ï¼Œå¹¶è®°å½•æ—¥å¿—ï¼š

![image-20250117142039628](assets/image-20250117142039628.png)

å†æ¬¡å‘èµ·ä¸‹è½½ï¼Œå¹¶æŸ¥çœ‹æ§åˆ¶å°ï¼Œå‘ç°è®¾ç½®å“åº”å¤´å¹¶æ²¡æœ‰ç”Ÿæ•ˆï¼Œå“åº”å¤´ä»ç„¶ä¿æŒæ—§å€¼ï¼š

![image-20250117142323625](assets/image-20250117142323625.png)

å°è¯•å°†å“åº”å¤´å…ˆç½®ä¸ºç©ºå­—ç¬¦ä¸²ï¼Œå†é‡æ–°è®¾ï¼š
![image-20250117143331932](assets/image-20250117143331932.png)

ç»“æœä¾ç„¶æ˜¯æ—§å€¼ï¼š

![image-20250117143351373](assets/image-20250117143351373.png)

å°è¯•ç›´æ¥è¦†ç›–å“åº”å¤´ï¼š

![image-20250117143446676](assets/image-20250117143446676.png)

ä¾ç„¶æ— æ•ˆï¼š

![image-20250117143602217](assets/image-20250117143602217.png)

**ä¸ºä»€ä¹ˆä¿®æ”¹(è¦†ç›–)å“åº”å¤´ï¼Ÿ**

è¿™æ˜¯å› ä¸ºä¸€æ—¦å“åº”å†…å®¹(å¦‚è¾“å‡ºæµ)å¼€å§‹å†™å…¥ï¼Œæˆ–è€…å·²ç»è¢«æäº¤(å³HTTPå“åº”å¤´å·²å‘é€åˆ°å®¢æˆ·ç«¯)ï¼Œå°±ä¸èƒ½å†ä¿®æ”¹å“åº”å¤´äº†ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œå“åº”å¤´çš„è®¾ç½®å‘ç”Ÿåœ¨è¾“å‡ºæµè·å–ä¹‹åï¼š

![image-20250117144418979](assets/image-20250117144418979.png)

**ä¸€æ—¦è·å–äº†è¾“å‡ºæµå°±è¡¨ç¤ºå“åº”ä½“éƒ¨åˆ†å¼€å§‹ç”Ÿæˆï¼Œæ­¤æ—¶å“åº”å¤´å·²ç»è¢«æäº¤**ã€‚

ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œå¯ä»¥å°†æ–‡ä»¶æ£€æŸ¥çš„é€»è¾‘ææ—©åˆ°è·å–è¾“å‡ºæµä¹‹å‰è¿›è¡Œã€‚å¦‚æœæ£€æŸ¥é€šè¿‡ï¼Œåˆ™ç»§ç»­è®¾ç½®æ–‡ä»¶ä¸‹è½½å¤´ï¼›å¦‚æœæ£€æŸ¥å¤±è´¥ï¼Œåˆ™è®¾ç½® JSON å“åº”å¤´ã€‚è™½ç„¶è¿™å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†åœ¨å¤„ç†å¤šæ–‡ä»¶ä¸‹è½½æ—¶ï¼Œéœ€è¦ä¸¤æ¬¡éå†ï¼šä¸€æ¬¡ç”¨äºæ£€æŸ¥æ–‡ä»¶ï¼Œä¸€æ¬¡ç”¨äºå‹ç¼©æ–‡ä»¶ã€‚è¿™æ ·æ˜¾å¾—æ¯”è¾ƒå†—ä½™ã€‚æ­¤å¤–ï¼Œå³ä¾¿èƒ½ç¡®ä¿æ–‡ä»¶æ£€æŸ¥æ—¶å“åº”é”™è¯¯çš„ JSONï¼Œè‹¥åœ¨å†™å‡ºæ•°æ®æ—¶å‘ç”Ÿå¼‚å¸¸ï¼Œä¾ç„¶æ— æ³•æ­£ç¡®å“åº”ã€‚å› æ­¤ï¼Œå½“å‰çš„ä¸‹è½½å®ç°å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œéœ€è¦è¿›ä¸€æ­¥ä¼˜åŒ–ã€‚

---

## 1.6 æ‰‹åŠ¨æ„å»ºå“åº”å®Œæˆä¸‹è½½

ä¸‹é¢å°†è¯¦ç»†ä»‹ç»ä¸€ç§æ‰‹åŠ¨æ„å»ºHTTPå“åº”çš„ä¸‹è½½æ–¹å¼ï¼Œè¯¥æ–¹æ³•åˆ©ç”¨Springæ¡†æ¶æä¾›çš„`ResponseEntity`ç±»è¿›è¡Œå“åº”æ„å»ºã€‚

`ResponseEntity`æ˜¯Springæä¾›çš„ä¸€ä¸ªä¸“é—¨ç”¨äºæ„å»ºå“åº”çš„ç±»ï¼Œå®ƒå¯ä»¥è¿”å›å®Œæ•´çš„HTTPå“åº”ï¼ŒåŒ…æ‹¬çŠ¶æ€ç ã€å“åº”å¤´å’Œå“åº”ä½“ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒHTTPå“åº”é€šå¸¸ç”±ä»¥ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼š

1. **çŠ¶æ€ç **ï¼šè¡¨ç¤ºè¯·æ±‚çš„å¤„ç†ç»“æœã€‚
2. **å“åº”å¤´**ï¼šåŒ…å«å…³äºå“åº”çš„å…ƒä¿¡æ¯ã€‚
3. **å“åº”ä½“**ï¼šå“åº”çš„å®é™…å†…å®¹ã€‚

`ResponseEntity`ä½¿æˆ‘ä»¬èƒ½å¤Ÿæ‰‹åŠ¨è®¾ç½®å“åº”å¤´å’Œå“åº”ä½“ã€‚å…·ä½“æ¥è¯´ï¼Œ`ResponseEntity`çš„å“åº”ä½“éƒ¨åˆ†å¯ä»¥æ¥æ”¶ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š

```java
<T> ResponseEntity<T> body(@Nullable T body);
```

åœ¨æ–‡ä»¶ä¸‹è½½çš„åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰‹åŠ¨æ„å»ºHTTPå“åº”ï¼Œä½¿å¾—å“åº”ä½“åŒ…å«æ–‡ä»¶çš„å†…å®¹ã€‚é€šè¿‡è®¾ç½®å“åº”å¤´ä¸­çš„`Content-Disposition`ä¸º"attachment"ï¼Œè§¦å‘æµè§ˆå™¨çš„ä¸‹è½½è¡Œä¸ºã€‚ç”±äºå“åº”ä½“ä¸­å­˜å‚¨çš„æ˜¯æ–‡ä»¶çš„å­—èŠ‚æ•°æ®ï¼Œæµè§ˆå™¨ä¼šæ ¹æ®è¿™äº›æ•°æ®è¿›è¡Œæ–‡ä»¶ä¸‹è½½ã€‚

æˆ‘ä»¬å¹³æ—¶æ§åˆ¶å™¨æ–¹æ³•è¿”å›çš„`Result`å¯¹è±¡ï¼Œä¹Ÿä¸æ˜¯ç›´æ¥è¿”å›ç»™å‰ç«¯çš„ï¼Œè€Œæ˜¯ç»è¿‡springåº•å±‚å°è£…ï¼Œå°†`Result`å°è£…åˆ°`ResponseEntity.body`ä¸­ï¼Œå®é™…å“åº”ç»™å‰ç«¯çš„ä»ç„¶æ˜¯`ResponseEntity`ï¼Œåªæ˜¯è¿™é‡Œæˆ‘ä»¬é€‰æ‹©æ‰‹åŠ¨æ„å»ºå“åº”ï¼Œå¯ä»¥æ›´ç»†è‡´çš„æ§åˆ¶`ResponseEntity`çš„é¢—ç²’åº¦ã€‚

**å¼‚å¸¸å¤„ç†**

ä¼ ç»Ÿçš„æ–‡ä»¶ä¸‹è½½é€šå¸¸ä¾èµ–äº`HttpServletResponse`æ¥è¿›è¡Œå“åº”å†™å…¥ï¼Œä½†è¿™ç§æ–¹æ³•å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨å‡ºç°å¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬æ— æ³•è¿”å›æ­£ç¡®çš„é”™è¯¯ä¿¡æ¯ã€‚åŸå› åœ¨äº`HttpServletResponse`å·²ç»ä¸å“åº”ç»‘å®šï¼Œè€Œæˆ‘ä»¬åªèƒ½å¯¹è¿™ä¸ªå“åº”è¿›è¡Œéƒ¨åˆ†ä¿®æ”¹ï¼Œå¦‚è®¾ç½®å“åº”ä½“æˆ–å“åº”å¤´ã€‚ä½†å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œæ— æ³•æ”¹å˜å·²æäº¤çš„å“åº”ã€‚

è€Œä½¿ç”¨`ResponseEntity`çš„æ–¹å¼åˆ™å¯ä»¥æ›´çµæ´»åœ°æ§åˆ¶å“åº”æ„å»ºçš„è¿‡ç¨‹ã€‚å½“å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ‰‹åŠ¨æ„å»ºçš„å“åº”ä¸­è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œä¿è¯å®¢æˆ·ç«¯èƒ½å¤Ÿæ­£ç¡®å¤„ç†å¼‚å¸¸æƒ…å†µã€‚

ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æˆ‘ä»¬æ‰‹åŠ¨æ„å»ºçš„å“åº”ï¼Œå¯ä»¥æ›´åŠ çš„çµæ´»æ§åˆ¶ã€‚å¦‚æœå‘ç”Ÿå¼‚å¸¸ï¼Œé‚£ä¹ˆå°±è¿”å›é”™è¯¯çš„å“åº”ï¼Œå¦‚æœæ­£å¸¸é‚£ä¹ˆè¿”å›æ–‡ä»¶æ•°æ®çš„å“åº”è®©æµè§ˆå™¨ä¸‹è½½ã€‚è€Œ`HttpServletResponse`å·²ç»æ˜¯ä¸€ä¸ªå“åº”ï¼Œæˆ‘ä»¬åªèƒ½åšå±€éƒ¨æ›´æ”¹ï¼Œä½†å¦‚æœåœ¨å†™å…¥è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œæˆ‘ä»¬æ— æ³•ä¿®æ”¹è¿™ä¸ªå“åº”å˜ä¸ºå¸¦æœ‰é”™è¯¯ä¿¡æ¯çš„ JSON å“åº”ã€‚

**æ‰‹åŠ¨æ„å»ºå“åº”çš„æ­¥éª¤**ï¼š

1. æ–¹æ³•è¿”å›ç±»å‹ä¸º`ResponseEntity`ã€‚
2. è¯»å–æ–‡ä»¶å†…å®¹ï¼Œå¹¶å°†å…¶è½¬ä¸ºå­—èŠ‚æ•°ç»„ã€‚
3. æ„å»ºå“åº”ï¼Œè®¾ç½®é€‚å½“çš„å“åº”å¤´ï¼Œç¡®ä¿æµè§ˆå™¨èƒ½å¤Ÿæ­£ç¡®ä¸‹è½½æ–‡ä»¶ã€‚
4. è‹¥å‘ç”Ÿå¼‚å¸¸ï¼Œè¿”å›é”™è¯¯å“åº”ã€‚é”™è¯¯å“åº”ä½“å¯ä»¥é€šè¿‡`Result.error()`æ„å»ºï¼Œæˆ–è€…ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œäº¤ç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨å¤„ç†ã€‚

å®ç°ä»£ç å¦‚ä¸‹ï¼š

```java
/**
     * æ–‡ç« é™„ä»¶ä¸‹è½½
     *
     * @param session
     * @param articleId
     * @param title
     * @param authorId
     * @param needPoints
     */
    @GetMapping("/attachment")
    @AccessControl(loginRequired = true)
    @Transactional(rollbackFor = Exception.class)
    public ResponseEntity<Object> attachmentDownload(HttpSession session,
                                                     @Validation(max = 15) String articleId, @Validation String title,
                                                     @Validation(max = 15) String authorId, @Validation Integer needPoints) throws IOException {
        UserInfoSessionDto userInfo = (UserInfoSessionDto) session.getAttribute(Constant.USERINFO_SESSION_KEY);
        List<Attachment> attachments = articleService.processAttachmentDownload(userInfo, articleId, title, authorId, needPoints);
//        try {
//
//        } catch (Exception e) {
//            log.error("é™„ä»¶ä¸‹è½½å¼‚å¸¸: {}", e);
//            BusinessException businessException = new BusinessException(e.getMessage());
//            return ResponseEntity.status(HttpStatus.INTERNAL_SERVER_ERROR)
//                    .body(Result.error(businessException));
//        }
        if (attachments.size() > 1) {
            return downloadAsZip(attachments);           // å‹ç¼©ä¸‹è½½
        } else {
            return downloadAsOne(attachments.get(0));    // å•æ–‡ä»¶ä¸‹è½½
        }
    }

/**
     * å•æ–‡ä»¶ä¸‹è½½
     *
     * @param attachment
     * @return
     * @throws IOException
     */
    private ResponseEntity<Object> downloadAsOne(Attachment attachment) throws IOException {
        File file = new File(toServerPath(attachment.getFilepath()));
        if (!file.exists() || file.isDirectory())
            throw new BusinessException(CommonMsg.FILE_NOT_FOUND);
        InputStream is = new FileInputStream(file);
        ByteArrayOutputStream aos = new ByteArrayOutputStream();
        IOUtils.copy(is, aos);      // è¾“å…¥æµä¸­çš„æ•°æ®å¤åˆ¶åˆ°è¾“å‡ºæµ
        HttpHeaders headers = new HttpHeaders();
        headers.add("Content-Type", MIMETypeEnum.getContentType(attachment.getFiletype()));
        String filename = URLEncoder.encode(attachment.getFilename());
        headers.add("Content-Disposition", "attachment; filename=" + filename);
        headers.add("Content-Length", String.valueOf(attachment.getFileSize()));

        return ResponseEntity.ok()
                .headers(headers)
                .body(aos.toByteArray());   // å“åº”ä½“å¡«å……å­—èŠ‚æ•°æ®
    }

/**
     * å¤šæ–‡ä»¶å‹ç¼©ä¸‹è½½
     *
     * @param attachments
     * @return
     * @throws IOException
     */
    private ResponseEntity<Object> downloadAsZip(List<Attachment> attachments) throws IOException {
        ByteArrayOutputStream aos = new ByteArrayOutputStream();
        try (ZipOutputStream zos = new ZipOutputStream(aos)) {
            for (Attachment attachment : attachments) {
                String serverPath = toServerPath(attachment.getFilepath());
                File file = new File(serverPath);
                if (!file.exists() || file.isDirectory())
                    throw new BusinessException(CommonMsg.FILE_NOT_FOUND);
                try (InputStream is = new FileInputStream(file)) {
                    ZipEntry zipEntry = new ZipEntry(attachment.getFilename());
                    zos.putNextEntry(zipEntry);
                    IOUtils.copy(is, zos);
                    zos.closeEntry();
                }
            }
        }
        // å‹ç¼©æµå…³é—­åï¼Œå†å†™å‡ºåˆ°å­—èŠ‚æ•°ç»„ï¼Œå¦åˆ™å‹ç¼©æ–‡ä»¶å†…å®¹ç¼ºå¤±
        byte[] byteArray = aos.toByteArray();
        HttpHeaders headers = new HttpHeaders();
        headers.add("Content-Type", MIMETypeEnum.ZIP.getContentType());
        String filename = URLEncoder.encode(String.format(Constant.ZIP_FILENAME, StrUtil.formatDate("_yyyyMMdd_hhmmss")));
        headers.add("Content-Disposition", "attachment; filename=" + filename);
        headers.add("Content-Length", String.valueOf(byteArray.length));

        return ResponseEntity.ok()
                .headers(headers)
                .body(byteArray);
    }
```

**ç»†èŠ‚è¯´æ˜**ï¼š

1ã€åœ¨è¿™é‡Œé€‰æ‹©`ByteArrayOutputStream`ä½œä¸ºè¾“å‡ºæµï¼Œå› ä¸ºå®ƒå¯ä»¥å°†æ–‡ä»¶å†…å®¹ä¸€æ¬¡æ€§è½¬æˆå­—èŠ‚æ•°ç»„ï¼Œæ–¹ä¾¿åœ¨æ„å»ºå“åº”ä½“æ—¶ä½¿ç”¨ã€‚å¹¶ä¸”ï¼Œç”±äº`ByteArrayOutputStream`æ˜¯åŸºäºå†…å­˜çš„ï¼Œæ•ˆç‡è¾ƒé«˜ä¸”ä¸éœ€è¦æ‰‹åŠ¨å…³é—­ã€‚

2ã€åœ¨è¾“å…¥æµå’Œè¾“å‡ºæµä¹‹é—´çš„æ•°æ®è½¬ç§»ï¼Œé‡‡ç”¨Apacheçš„`IOUtils.copy()`æ–¹æ³•ï¼Œå®ƒèƒ½å¤Ÿé«˜æ•ˆåœ°å°†è¾“å…¥æµä¸­çš„æ•°æ®å¤åˆ¶åˆ°è¾“å‡ºæµã€‚

3ã€åœ¨è¿›è¡Œå¤šæ–‡ä»¶å‹ç¼©ä¸‹è½½æ—¶ï¼Œéœ€è¦ç¡®ä¿å‹ç¼©æµï¼ˆ`ZipOutputStream`ï¼‰å…³é—­åå†å°†å†…å®¹å†™å…¥å­—èŠ‚æ•°ç»„ã€‚å¦åˆ™ï¼Œå‹ç¼©æ–‡ä»¶çš„å†…å®¹å¯èƒ½ä¼šä¸¢å¤±ï¼š

```java
try(ZipOutputStream zos = new ZipOutputStream(aos)){
    ...
}
// æ”¾åˆ°try(){}ä¹‹åï¼Œç¡®ä¿zoså…³é—­èµ„æºï¼Œå†å†™å…¥åˆ°æ•°ç»„ä¸­
byte[] byteArray = aos.toByteArray();
```

ä¸è¦æ”¾åˆ°try(){}å†…ï¼š

```java
try(ZipOutputStream zos = new ZipOutputStream(aos)){
    ...
    // æ­¤æ—¶å†™å…¥ï¼Œzosæœªå…³é—­ï¼Œä¼šç¼ºå¤±æœ€åä¸€éƒ¨åˆ†æ•°æ®
    byte[] byteArray = aos.toByteArray();
}
```

4ã€æˆ‘ä»¬å¯ä»¥é€‰æ‹©æ•è·å¼‚å¸¸å¹¶è¿”å›è‡ªå®šä¹‰çš„é”™è¯¯å“åº”ï¼Œæˆ–è€…å°†å¼‚å¸¸æŠ›å‡ºäº¤ç”±å…¨å±€å¼‚å¸¸å¤„ç†å™¨è¿›è¡Œå¤„ç†ã€‚å¦‚æœé€‰æ‹©è‡ªå®šä¹‰å“åº”ï¼Œè¿”å›é”™è¯¯å“åº”ï¼Œéœ€è¦ç¡®ä¿é”™è¯¯ä¿¡æ¯ä½œä¸ºå“åº”ä½“è¿”å›ï¼Œè€Œä¸æ˜¯ç›´æ¥ä¿®æ”¹å“åº”å¯¹è±¡ï¼Œå¦åˆ™æµè§ˆå™¨å¯èƒ½æ— æ³•æ­£ç¡®å¤„ç†ã€‚