# 1 系统设置

可以通过提前设定一系列参数值，并在需要时从设置项中获取并使用这些参数。例如，设置一个积分规则，其中包括用户注册时默认获得的积分数和发布帖时获得的积分数。类似地，用户发送文件的大小限制等设置也可以预设。这样，设置的参数可以根据需求灵活调整，确保系统灵活性和可配置性。

效果图如下：

![image-20241118213932875](assets/image-20241118213932875.png)

这些预设的参数需要存储在数据库中，并且在系统启动时从数据库加载并将其存入内存，在整个系统的生命周期中使用这些启动时加载的配置项。

由于设置项需要存储在数据库中，我们需要设计合适的表结构。上诉的6个设置项，是否为需要每个设置项单独创建一张表呢？这显然不是一个高效的方案。如果以后需要新增设置项，难道每次都需要创建一张新表吗？仔细分析后发现，实际上每个设置项都可以视作一个对象，设置项中的各字段对应对象的属性。因此，我们可以设计一张表来统一存储所有设置项，每一行数据代表一个设置项。表中至少需要两个字段：【code】和【json_content】。

- 【code】：存储设置项的标识或名称；
- 【json_content】：存储设置项的具体内容，以JSON字符串形式表示，方便扩展和修改。

采用JSON格式存储配置项的具体字段，可以让我们灵活地表达和管理这些设置项。启动时，我们只需要从数据库中读取这些数据，然后将【json_content】字段反序列化为对象，并将其存入相应的实体类中，便于后续的操作和维护。这样既能避免为每个设置项单独建表，又能提高系统的灵活性和可扩展性。

## 1.1 sys_setting

系统设置表，表结构如下：

```sql
create table sys_setting
(
    code         varchar(10)  not null comment '编码'
        primary key,
    json_content varchar(500) null comment '设置信息的json字符串',
    create_time  datetime     not null comment '创建时间',
    update_time  datetime     not null comment '修改时间'
)
    comment '系统设置信息表';
```

根据效果图中的6种设置信息，我们设计如下的json消息：

1、注册欢迎消息，它的【code】为：

```
register
```

【json_content】为：

```json
{
    "welcomeInfo": "恭喜您成功注册！在这里，每一位成员都是我们宝贵的一部分。希望您能在社区中找到灵感，分享智慧，一起成长！"
}
```

2、邮件设置，它的【code】为：

```
mail
```

【json_content】为：

```json
// %s占位符，到时候替换为具体的验证码
{
    "mailTitle": "邮箱验证码",
    "mailContent": "您好！您的邮箱验证码为：%s。验证码有效时间为5分钟，请尽快完成注册。感谢您的支持！"
}
```

3、审核设置，它的【code】为：

```
audit
```

【json_content】为：

```json
{
    "postAudit": true,		// 帖子是否需要审核
    "commentAudit": true	// 评论是否需要审核
}
```

4、发帖设置，它的【code】为：

```
post
```

【json_content】为：

```json
{
    "postPoints": 3,		// 帖子是否需要审核
    "postNum": 3,			// 每天可发帖数量
    "uploadImgNum": 50,		// 每天可上传图片数量
    "attachmentSize": 3		// 附件大小
}
```

5、评论设置，它的【code】为：

```
comment
```

【json_content】为：

```json
{
    "openComment": true,		// 是否开启评论
    "commentPoints": 3,			// 评论积分
    "commentNum": 50			// 每天可发评论数量
}
```

6、点赞设置，它的【code】为：

```
like
```

【json_content】为：

```json
{
    "likeNum": 20		// 每天可点赞数量
}
```

综上，完整的插入sql为：

```sql
INSERT INTO ling_bbs.sys_setting (code, json_content, create_time, update_time) VALUES ('audit', '{"postAudit": true,"commentAudit": true}', '2024-11-18 22:41:36', '2024-11-18 22:41:51');
INSERT INTO ling_bbs.sys_setting (code, json_content, create_time, update_time) VALUES ('comment', '{"openComment": true,"commentPoints": 3,"commentNum": 50}', '2024-11-18 22:41:44', '2024-11-18 22:41:52');
INSERT INTO ling_bbs.sys_setting (code, json_content, create_time, update_time) VALUES ('like', '{"likeNum": 20}', '2024-11-18 22:41:47', '2024-11-18 22:41:53');
INSERT INTO ling_bbs.sys_setting (code, json_content, create_time, update_time) VALUES ('mail', '{"mailTitle": "邮箱验证码","mailContent": "您好！您的邮箱验证码为：%s。验证码有效时间为5分钟，请尽快完成注册。感谢您的支持！"}', '2024-11-18 22:41:48', '2024-11-18 22:41:54');
INSERT INTO ling_bbs.sys_setting (code, json_content, create_time, update_time) VALUES ('post', '{"postPoints": 3,"postNum": 3,"uploadImgNum": 50,"attachmentSize": 3}', '2024-11-18 22:41:49', '2024-11-18 22:41:55');
INSERT INTO ling_bbs.sys_setting (code, json_content, create_time, update_time) VALUES ('register', '{"welcomeInfo": "恭喜您成功注册！在这里，每一位成员都是我们宝贵的一部分。希望您能在社区中找到灵感，分享智慧，一起成长！"}', '2024-11-18 22:41:50', '2024-11-18 22:41:56');
```

## 1.2 创建对应实体

首先是【SysSetting】，作为表实体需要创建对应的CRUD，这里不展示，参考[springboot-vue-note](https://github.com/lingzed/springboot-vue-note/tree/main)第26章。

然后创建6中设置对应的实体，命名规则统一以SysSetting4为前缀，4通for：

比如审核设置：

```java
package com.ling.entity.po;

/**
 * 系统设置-审核设置
 */
public class SysSetting4Audit {
    private boolean postAudit;          // 发布帖是否需要审核
    private boolean commentAudit;       // 评论是否需要审核


    public SysSetting4Audit() {
    }

    public SysSetting4Audit(boolean postAudit, boolean commentAudit) {
        this.postAudit = postAudit;
        this.commentAudit = commentAudit;
    }

    /**
     * 获取
     * @return postAudit
     */
    public boolean isPostAudit() {
        return postAudit;
    }

    /**
     * 设置
     * @param postAudit
     */
    public void setPostAudit(boolean postAudit) {
        this.postAudit = postAudit;
    }

    /**
     * 获取
     * @return commentAudit
     */
    public boolean isCommentAudit() {
        return commentAudit;
    }

    /**
     * 设置
     * @param commentAudit
     */
    public void setCommentAudit(boolean commentAudit) {
        this.commentAudit = commentAudit;
    }

    public String toString() {
        return "SysSetting4Audit{postAudit = " + postAudit + ", commentAudit = " + commentAudit + "}";
    }
}
```

其他按照此实体完成，这里不展示。



​                                                                                                                                                                        