# 1 æŸ¥è¯¢æ–‡ç« è¯¦æƒ…

æŸ¥è¯¢æ–‡ç« è¯¦æƒ…ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨`findById()`ï¼Œå› ä¸ºè¯¥æ–¹æ³•ä»…é€šè¿‡æ–‡ç« IDè¿›è¡ŒæŸ¥è¯¢ã€‚æ— æ³•å¤„ç†æµè§ˆé‡çš„æ›´æ–°ã€‚ä¸ºäº†åœ¨ç”¨æˆ·æŸ¥çœ‹æ–‡ç« æ—¶å¢åŠ æµè§ˆé‡ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œè¯¥æ–¹æ³•éœ€è¦å®ç°è‡³å°‘ä¸¤ä¸ªåŠŸèƒ½ï¼š

- è¿”å›æ–‡ç« çš„è¯¦ç»†ä¿¡æ¯ã€‚
- å¢åŠ æ–‡ç« çš„æµè§ˆé‡ã€‚

é€šå¸¸ï¼Œå¢åŠ æµè§ˆé‡çš„éœ€æ±‚æœ‰ä»¥ä¸‹å‡ ç§å¸¸è§çš„å®ç°æ–¹å¼ï¼š

1. **æ— è®ºæ˜¯å¦ç™»å½•ï¼Œåªè¦è®¿é—®æ¥å£ï¼Œå°±å¢åŠ æµè§ˆé‡**ï¼šæ¯æ¬¡ç”¨æˆ·è®¿é—®æ¥å£æ—¶ï¼Œéƒ½ä¼šå¢åŠ æµè§ˆé‡ï¼Œæ— éœ€è€ƒè™‘ç”¨æˆ·æ˜¯å¦ç™»å½•ã€‚
2. **æ— è®ºæ˜¯å¦ç™»å½•ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡è®¿é—®æ¥å£æ—¶æ‰å¢åŠ æµè§ˆé‡**ï¼šåªæœ‰åœ¨ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶å¢åŠ æµè§ˆé‡ï¼Œä¹‹åçš„è®¿é—®ä¸å†å¢åŠ ã€‚
3. **åªæœ‰åœ¨ç™»å½•æ—¶ï¼Œè®¿é—®æ¥å£æ‰å¢åŠ æµè§ˆé‡**ï¼šåªæœ‰ç™»å½•ç”¨æˆ·è®¿é—®æ—¶æ‰ä¼šå¢åŠ æµè§ˆé‡ï¼Œæœªç™»å½•ç”¨æˆ·è®¿é—®æ—¶ä¸ä¼šè§¦å‘æµè§ˆé‡æ›´æ–°ã€‚
4. **åªæœ‰åœ¨ç™»å½•æ—¶ï¼Œä¸”ä¸ºç¬¬ä¸€æ¬¡è®¿é—®æ¥å£æ—¶ï¼Œæ‰å¢åŠ æµè§ˆé‡**ï¼šç™»å½•ç”¨æˆ·é¦–æ¬¡è®¿é—®æ—¶å¢åŠ æµè§ˆé‡ï¼Œä¹‹åè®¿é—®ä¸å†å¢åŠ æµè§ˆé‡ã€‚

æ ¹æ®å…·ä½“éœ€æ±‚çš„ä¸åŒï¼Œå¯ä»¥é€‰æ‹©é€‚åˆçš„æ–¹æ¡ˆã€‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬é€‰æ‹©å®ç°ç¬¬ä¸‰ç§éœ€æ±‚ï¼š**åªæœ‰åœ¨ç”¨æˆ·ç™»å½•æ—¶ï¼Œè®¿é—®æ¥å£æ‰å¢åŠ æµè§ˆé‡**ã€‚

---

## 1.1 a = a + valueçº¿ç¨‹å®‰å…¨é—®é¢˜

```sql
update table set a = a + value where condition;
```

`a = a + value`æœ¬èº«ä¸æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„æ“ä½œï¼Œå®ƒåŒ…å«è¯»å–ã€æ›´æ–°ã€å†™å›ä¸‰ä¸ªæ­¥éª¤ï¼Œå› æ­¤å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä½†æ˜¯`a = a + value`ä¸`update`ç»“åˆèµ·æ¥å´æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå› ä¸ºä½¿ç”¨ `update` è¯­å¥æ›´æ–°æ•°æ®æ—¶ï¼Œæ•°æ®åº“ä¼šåœ¨æ‰§è¡Œè¯¥æ“ä½œæ—¶ä¼šé‡‡å–æªæ–½å¦‚ï¼šåŠ è¡Œé”ï¼Œç¡®ä¿åœ¨åŒä¸€æ—¶é—´å†…åªæœ‰ä¸€ä¸ªäº‹åŠ¡èƒ½å¤ŸæˆåŠŸæ›´æ–°æ•°æ®ã€‚æ‰€ä»¥å¢åŠ æµè§ˆé‡çš„æ“ä½œä¸éœ€è¦åŠ é”ï¼š

```sql
update article set read_count = read_count + 1 where article_id = ?
```

---

### 1.1.1 ç§¯åˆ†æ“ä½œçš„çº¿ç¨‹å®‰å…¨ç»†èŠ‚

åœ¨æ›´æ–°ç”¨æˆ·ç§¯åˆ†çš„åœºæ™¯ä¸­ï¼ˆè§[9.ç§¯åˆ†è¡¨ä»¥åŠå¯¹åº”CRUD.md](9.ç§¯åˆ†è¡¨ä»¥åŠå¯¹åº”CRUD.md)ï¼‰ï¼Œæˆ‘é‡‡ç”¨äº†ä¹è§‚é”æœºåˆ¶æ¥å®ç°çº¿ç¨‹å®‰å…¨ã€‚ç§¯åˆ†æ›´æ–°æ˜¯åŸºäºåŸæœ‰ç§¯åˆ†çš„å˜æ›´æ“ä½œï¼Œé‚£ä¹ˆæ˜¯å¦å¯ä»¥é€šè¿‡`UPDATE`çš„è¡Œé”æ¥æ›¿ä»£ä¹è§‚é”å‘¢ï¼Ÿ

**ç†è®ºä¸Šå¯ä»¥ï¼Œä½†åœ¨è¿™ä¸ªåœºæ™¯ä¸­å¹¶ä¸é€‚ç”¨ã€‚**

ä½¿ç”¨`UPDATE`åŠ è¡Œé”ï¼Œæ›´æ–°ç§¯åˆ†çš„ SQL æ˜¯è¿™æ ·çš„ï¼š

```sql
update user_info set current_points = current_points + ? where user_id = ?
```

è¿™ç§æ–¹å¼çš„ç¡®èƒ½å¤Ÿä¿è¯æ›´æ–°æ“ä½œçš„çº¿ç¨‹å®‰å…¨ï¼Œä½†æ— æ³•é¿å…ç§¯åˆ†å‡ºç°è´Ÿå€¼çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼Œåœ¨æ‰£å‡ç§¯åˆ†æ—¶ï¼Œå¦‚æœæ‰£å‡çš„ç§¯åˆ†è¶…è¿‡äº†å½“å‰ç§¯åˆ†ï¼Œå°±ä¼šå¯¼è‡´ç§¯åˆ†å˜ä¸ºè´Ÿæ•°ï¼Œè€Œè¿™æ˜¯æˆ‘ä»¬éœ€è¦é¿å…çš„ã€‚

ä¸ºäº†é˜²æ­¢ç§¯åˆ†ä¸ºè´Ÿï¼Œæˆ‘ä»¬å¯ä»¥åœ¨`WHERE`å­å¥ä¸­å¢åŠ é™åˆ¶æ¡ä»¶ï¼š

```sql
update user_info set current_points = current_points + ? where user_id = ? and current_points + ? >= 0
```

é€šè¿‡`current_points + ? >= 0`çš„æ¡ä»¶ï¼Œå½“æ‰£å‡æ“ä½œå¯¼è‡´ç§¯åˆ†å°äº 0 æ—¶ï¼Œæ›´æ–°æ“ä½œå°†ä¸ä¼šæ‰§è¡Œã€‚è¿™ç§æ–¹å¼èƒ½åœ¨ä¸€å®šç¨‹åº¦ä¸Šè§£å†³é—®é¢˜ï¼šæ—¢ä¿è¯äº†ç§¯åˆ†ä¸ä¸ºè´Ÿæ•°ï¼Œä¹Ÿç»´æŒäº†çº¿ç¨‹å®‰å…¨ã€‚

ç„¶è€Œï¼Œè¿™ç§æ–¹æ³•ä»ç„¶å­˜åœ¨å±€é™æ€§ã€‚ä¾‹å¦‚ï¼Œå½“è¿›è¡Œæ‰£å‡æ“ä½œæ—¶ï¼Œå¦‚æœæ‰£å‡åç§¯åˆ†åº”ä¸ºè´Ÿæ•°ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡éœ€æ±‚æ˜¯å°†ç§¯åˆ†å¼ºåˆ¶ç½®ä¸º 0ã€‚è¿™ä¸€ç‚¹åœ¨ä»£ç ä¸­æœ‰æ‰€ä½“ç°ï¼Œé€šè¿‡æ¯”è¾ƒæ›´æ–°åçš„ç§¯åˆ†ä¸ 0 çš„å¤§å°æ¥å®ç°ï¼š

![image-20250114203827326](assets/image-20250114203827326.png)

ä½†ä¸Šè¿° SQL æ— æ³•æ»¡è¶³è¿™ä¸€éœ€æ±‚ï¼Œå› ä¸ºå½“ç§¯åˆ†å˜æ›´åå°äº 0 æ—¶ï¼ŒSQL æ ¹æœ¬ä¸ä¼šæ‰§è¡Œæ›´æ–°æ“ä½œã€‚å› æ­¤ï¼Œ`UPDATE`åŠ è¡Œé”å¹¶ä¸å®Œå…¨é€‚ç”¨äºè¯¥åœºæ™¯ã€‚

**ä¸ºæ»¡è¶³ä¸šåŠ¡éœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦é‡‡ç”¨ä¸¤æ­¥æ“ä½œï¼šå…ˆæŸ¥è¯¢å½“å‰ç§¯åˆ†ï¼Œå†è¿›è¡Œæ›´æ–°æ“ä½œã€‚**
å…·ä½“æ­¥éª¤ä¸ºï¼š

1. æŸ¥è¯¢å½“å‰ç§¯åˆ†å€¼ï¼›
2. å°†æŸ¥è¯¢ç»“æœä¸å˜æ›´é‡è®¡ç®—åæ‰§è¡Œæ›´æ–°ã€‚

è™½ç„¶`UPDATE`åŠ è¡Œé”èƒ½ä¿è¯å•æ¬¡æ›´æ–°æ“ä½œçš„çº¿ç¨‹å®‰å…¨ï¼Œä½†æ— æ³•ä¿è¯æŸ¥è¯¢å’Œæ›´æ–°è¿™ä¸¤æ­¥æ“ä½œçš„æ•´ä½“çº¿ç¨‹å®‰å…¨ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

- å½“å‰ç§¯åˆ†ä¸º 2ï¼Œçº¿ç¨‹ A å’Œçº¿ç¨‹ B åˆ†åˆ«å°è¯•æ›´æ–°ç§¯åˆ†ï¼ŒA å¢åŠ  2ï¼ŒB å¢åŠ  3ã€‚
- A å…ˆè¯»å–åˆ°ç§¯åˆ†å€¼ä¸º 2ï¼Œå¹¶åœ¨æ‰§è¡Œæ›´æ–°æ“ä½œå‰ï¼ŒB ä¹Ÿè¯»å–åˆ°åŒæ ·çš„å€¼ 2ã€‚
- å½“ A æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶ï¼ŒåŠ äº†è¡Œé”ï¼ŒB è¢«é˜»å¡ç­‰å¾…ã€‚A å°†ç§¯åˆ†æ›´æ–°ä¸º 4 åï¼ŒB è·å¾—è¡Œé”å¹¶æ‰§è¡Œæ›´æ–°ï¼Œä½† B ä½¿ç”¨çš„æ˜¯æ—§å€¼ 2ï¼Œæœ€ç»ˆå°†ç§¯åˆ†æ›´æ–°ä¸º 5ï¼Œè¦†ç›–äº† A çš„ç»“æœã€‚
- æœ€ç»ˆç»“æœæ˜¯ç§¯åˆ†ä¸º 5ï¼Œè€Œä¸æ˜¯æœŸæœ›çš„ 7ã€‚

**è¿™è¯´æ˜ï¼Œå³ä¾¿æ›´æ–°æ“ä½œæœ¬èº«æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†æŸ¥è¯¢å’Œæ›´æ–°çš„ç»„åˆæ“ä½œå¹¶éçº¿ç¨‹å®‰å…¨ã€‚**æ‰€ä»¥æˆ‘æ‰ä¼šä½¿ç”¨ä¹è§‚é”æ¥å®ç°ã€‚

> é€šå¸¸æƒ…å†µä¸‹èƒ½ä¸€å¥`update`å®ç°çš„æ›´æ–°æ“ä½œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœèƒ½ä¿è¯ç»è¿‡`where`æ¡ä»¶è¿‡æ»¤ååªæœ‰ä¸€æ¡æ•°æ®ï¼Œå³åªæ›´æ–°è¿™ä¸€æ¡æ•°æ®é‚£ä¹ˆä¸€å®šæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚

---

## 1.2 æ–‡ç« ä¸åŒçŠ¶æ€çš„æŸ¥è¯¢æƒ…å†µ

1. æœªç™»å½•ç”¨æˆ·ä¸èƒ½è®¿é—®å·²åˆ é™¤ã€å¾…å®¡æ ¸æ–‡ç« ã€‚
2. ç®¡ç†å‘˜ä¸èƒ½è®¿é—®å·²åˆ é™¤æ–‡ç« ã€‚
3. å·²ç™»å½•ç”¨æˆ·ä¸èƒ½è®¿é—®å·²åˆ é™¤ã€å¾…å®¡æ ¸ä½†ä½œè€…ä¸æ˜¯è‡ªå·±çš„æ–‡ç« ã€‚

é€»è¾‘åˆ¤æ–­æ¯”è¾ƒå¤šï¼Œå¯ä»¥å®šä¹‰ä¸€äº›å˜é‡æ¥å­˜å‚¨è¿™äº›åˆ¤æ–­ï¼Œè®©é€»è¾‘æ›´åŠ æ¸…æ™°ï¼š

```java
boolean isLogin;	// æ˜¯å¦ç™»å½•
boolean isDeleted;	// æ˜¯å¦åˆ é™¤
boolean isPending;	// æ˜¯å¦å¾…å®¡æ ¸
boolean isAudited;	// æ˜¯å¦å·²å®¡æ ¸
boolean isAuthor;	// æ˜¯å¦æ˜¯ä½œè€…
```

å¯¹äºä¸èƒ½è®¿é—®çš„æ–‡ç« ï¼Œæˆ‘ä»¬æŠ›å‡º404é”™è¯¯ã€‚

ä¸ç®¡æœ‰æ²¡æœ‰ç™»å½•ï¼Œåˆ é™¤çš„æ–‡ç« éƒ½ä¸èƒ½è®¿é—®ï¼š

```java
if(isDeleted)
    throw new BusinessException(ResponseCodeEnum.CODE_404);
```

è‹¥è®¿é—®æœªåˆ é™¤çš„æ–‡ç« ï¼Œé‚£ä¹ˆæœªç™»å½•çš„ç”¨æˆ·ä¸èƒ½è®¿é—®å¾…å®¡æ ¸çš„æ–‡ç« ï¼š

```java
if(isDeleted)
    throw new BusinessException(ResponseCodeEnum.CODE_404);

if (!isLogin && isPending)
            throw new BusinessException(ResponseCodeEnum.CODE_404);
```

è‹¥è®¿é—®æœªåˆ é™¤çš„æ–‡ç« ï¼Œä¸”ç”¨æˆ·å·²ç™»å½•ï¼Œé‚£ä¹ˆå¦‚æœä»–ä¸æ˜¯ç®¡ç†å‘˜ï¼Œå°±ä¸èƒ½è®¿é—®ä½œè€…ä¸æ˜¯è‡ªå·±çš„å¾…å®¡æ ¸æ–‡ç« ï¼š

```java
if(isDeleted)
    throw new BusinessException(ResponseCodeEnum.CODE_404);

if (!isLogin && isPending)
            throw new BusinessException(ResponseCodeEnum.CODE_404);

if (isLogin && !userinfo.getIsAdmin() && isPending && !isAuthor)
            throw new BusinessException(ResponseCodeEnum.CODE_404);
```

ä»¥ä¸Šå°±æ˜¯å®Œæ•´çš„é€»è¾‘åˆ¤æ–­ã€‚

### 1.2.1 çŠ¶æ€çŸ©é˜µ

ä¸åŒç”¨æˆ·è®¿é—®æ–‡ç« ä¸æ–‡ç« çš„çŠ¶æ€æœ‰å…³ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥æ­¤æ¥å»ºç«‹ä¸€ä¸ª**ç™»å½•æƒ…å†µ**ä¸**æ–‡ç« çŠ¶æ€**çš„å…³ç³»è¡¨ï¼š

è¡Œä»£è¡¨ä¸åŒçš„ç™»å½•æƒ…å†µï¼Œåˆ—ä»£è¡¨ä¸åŒçš„æ–‡ç« çŠ¶æ€ã€‚å¦‚æœå½“å‰ç™»å½•æƒ…å†µéœ€è¦å¯¹å½“å‰çŠ¶æ€è¿›è¡Œé™åˆ¶ï¼Œæˆ–å…¶ä»–æ“ä½œï¼Œé‚£ä¹ˆå°±âœ”ï¼Œå°±åƒè¿™æ ·ï¼š

| ç™»å½•æƒ…å†µ/æ–‡ç« çŠ¶æ€ | å·²åˆ é™¤ | å¾…å®¡æ ¸ | å·²å®¡æ ¸ |
| ----------------- | ------ | ------ | ------ |
| ç®¡ç†å‘˜            | âœ”      |        |        |
| ä¸€èˆ¬ç”¨æˆ·          | âœ”      | âœ”      |        |
| æœªç™»å½•            | âœ”      | âœ”      |        |

æŸ¥è¯¢å·²åˆ é™¤çš„æ–‡ç« æ—¶ï¼Œç®¡ç†å‘˜ã€ä¸€èˆ¬ç”¨æˆ·ã€æœªç™»å½•ç”¨æˆ·éƒ½éœ€è¦è¿›è¡Œé™åˆ¶ã€‚å› æ­¤3ä¸­æƒ…å†µéƒ½âœ”ã€‚

æŸ¥è¯¢å¾…å®¡æ ¸æ–‡ç« æ—¶ï¼Œåªæœ‰ä¸€èˆ¬ç”¨æˆ·ã€æœªç™»å½•ç”¨æˆ·éœ€è¦è¿›è¡Œé™åˆ¶ã€‚å› æ­¤ä¸€èˆ¬ç”¨æˆ·ã€æœªç™»å½•éƒ½âœ”ã€‚

æŸ¥è¯¢å·²å®¡æ ¸æ–‡ç« æ—¶ï¼Œæ‰€æœ‰ç™»å½•æƒ…å†µéƒ½ä¸éœ€è¦åšé™åˆ¶ã€‚

æœ€ç»ˆè¿™å¼ è¡¨ä¸­âœ”çš„å°±æ˜¯éœ€è¦åšå‡ºé™åˆ¶çš„æƒ…å†µã€‚è¡¨ä¸­ä¸€å…±æœ‰5ä¸­æƒ…å†µï¼Œå…¶ä¸­å·²åˆ é™¤çš„3ä¸­æƒ…å†µå¯ä»¥åˆå¹¶ä¸º1ç§ï¼Œå› æ­¤æ€»å…±æœ‰3ç§æƒ…å†µï¼Œååº”åˆ°ä»£ç ä¸­å°±æ˜¯è¿™3ä¸­æ¡ä»¶é™åˆ¶ï¼š

```java
if(isDeleted)
    throw new BusinessException(ResponseCodeEnum.CODE_404);

if (!isLogin && isPending)
            throw new BusinessException(ResponseCodeEnum.CODE_404);

if (isLogin && !userinfo.getIsAdmin() && isPending && !isAuthor)
            throw new BusinessException(ResponseCodeEnum.CODE_404);
```

å½“é€»è¾‘å¤æ‚æˆ–è€…çŠ¶æ€å’Œæ¡ä»¶çš„ç»„åˆè¾ƒå¤šæ—¶ï¼Œä½ ä¸èƒ½è½»æ˜“çš„æ•´ç†å‡ºé€»è¾‘åˆ¤æ–­ï¼Œé‚£ä¹ˆä½¿ç”¨**çŠ¶æ€çŸ©é˜µ**æ˜¯ä¸€ç§éå¸¸æœ‰æ•ˆçš„æ–¹æ³•ã€‚çŠ¶æ€çŸ©é˜µå¯ä»¥æ¸…æ™°åœ°ç†æ¸…å¤æ‚é€»è¾‘ï¼Œå°¤å…¶æ˜¯åœ¨ä»¥ä¸‹åœºæ™¯ä¸­éå¸¸æœ‰ç”¨ï¼š

1.  æ¡ä»¶å¤æ‚ï¼Œå®¹æ˜“é—æ¼æ—¶ã€‚
2.  éœ€è¦åˆå¹¶æˆ–ä¼˜åŒ–é€»è¾‘æ—¶ã€‚
3.  éœ€è¦å¢åŠ æ–°çŠ¶æ€æˆ–æ¡ä»¶æ—¶ã€‚

---

## 1.3 æ–‡ç« è¯¦æƒ…voå’Œé™„ä»¶vo

`ArticleVo`åªæ˜¯æ–‡ç« åˆ—è¡¨çš„voï¼Œæ–‡ç« è¯¦æƒ…è¿˜éœ€è¦å¦å¤–å®šä¹‰voï¼Œå…¶å®å°±æ˜¯åœ¨`ArticleVo`å¤–é¢å¥—ä¸€å±‚ï¼Œå› ä¸ºé™„ä»¶ä¹Ÿæœ‰ä¸€ä¸ªvoï¼ŒæŸ¥çœ‹æ–‡ç« è¯¦æƒ…åŒæ—¶å°±å¯ä»¥æŸ¥çœ‹åˆ°é™„ä»¶ï¼Œç›¸å½“äºæ–‡ç« è¯¦æƒ…vo = `ArticleVo` + é™„ä»¶voã€‚

`ArticleVo` æ˜¯ç”¨äºå±•ç¤ºæ–‡ç« åˆ—è¡¨çš„è§†å›¾å¯¹è±¡ï¼Œè€Œæ–‡ç« è¯¦æƒ…åˆ™éœ€è¦å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„VOã€‚æ–‡ç« è¯¦æƒ…VOå®é™…ä¸Šæ˜¯å°† `ArticleVo` åŒ…å«åœ¨å†…ï¼Œå¹¶åŒæ—¶åŒ…å«é™„ä»¶ä¿¡æ¯ã€‚ç®€è€Œè¨€ä¹‹ï¼Œæ–‡ç« è¯¦æƒ…VO = `ArticleVo` + é™„ä»¶VOã€‚

**é™„ä»¶vo**ï¼š

```java
package com.ling.entity.vo;

/**
 * é™„ä»¶ä¿¡æ¯VO
 */
public class AttachmentVo {
    private String fileId;  // æ–‡ä»¶ID
    private String filename; // æ–‡ä»¶å
    private Long filesize; // æ–‡ä»¶å¤§å°
    private Integer filetype; // æ–‡ä»¶ç±»å‹
    private Integer downloadCount; // ä¸‹è½½æ¬¡æ•°
    private Integer downloadPoints; // ä¸‹è½½æ‰€éœ€ç§¯åˆ†

    public String getFileId() {
        return fileId;
    }

    public void setFileId(String fileId) {
        this.fileId = fileId;
    }

    public String getFilename() {
        return filename;
    }

    public void setFilename(String filename) {
        this.filename = filename;
    }

    public Long getFilesize() {
        return filesize;
    }

    public void setFilesize(Long filesize) {
        this.filesize = filesize;
    }

    public Integer getFiletype() {
        return filetype;
    }

    public void setFiletype(Integer filetype) {
        this.filetype = filetype;
    }

    public Integer getDownloadCount() {
        return downloadCount;
    }

    public void setDownloadCount(Integer downloadCount) {
        this.downloadCount = downloadCount;
    }

    public Integer getDownloadPoints() {
        return downloadPoints;
    }

    public void setDownloadPoints(Integer downloadPoints) {
        this.downloadPoints = downloadPoints;
    }
}
```

**æ–‡ç« è¯¦æƒ…vo**ï¼š

`ArticleDetailVo` æ˜¯ç”¨äºå±•ç¤ºæ–‡ç« è¯¦ç»†ä¿¡æ¯çš„è§†å›¾å¯¹è±¡ã€‚å®ƒåŒ…å«ä»¥ä¸‹å‡ ä¸ªé‡è¦å­—æ®µï¼š

- `article`ï¼šåŒ…å«æ–‡ç« çš„åŸºæœ¬ä¿¡æ¯ï¼Œç±»å‹ä¸º `ArticleVo`ã€‚
- `attachments`ï¼šåŒ…å«ä¸æ–‡ç« ç›¸å…³çš„é™„ä»¶åˆ—è¡¨ï¼Œç±»å‹ä¸º `List<AttachmentVo>`ï¼Œæ¯ç¯‡æ–‡ç« å¯ä»¥æœ‰å¤šä¸ªé™„ä»¶ã€‚
- `haveLike`ï¼šè¡¨ç¤ºå½“å‰ç”¨æˆ·æ˜¯å¦å·²ç»å¯¹è¯¥æ–‡ç« è¿›è¡Œäº†ç‚¹èµã€‚

```java
package com.ling.entity.vo;

import java.util.List;

/**
 * æ–‡ç« è¯¦æƒ…VO
 */
public class ArticleDetailVo {
    private ArticleVo article;  // æ–‡ç« ä¿¡æ¯
    private List<AttachmentVo> attachments; // é™„ä»¶ä¿¡æ¯
    private boolean haveLike; // æ˜¯å¦ç‚¹èµ

    public ArticleVo getArticle() {
        return article;
    }

    public void setArticle(ArticleVo article) {
        this.article = article;
    }

    public List<AttachmentVo> getAttachments() {
        return attachments;
    }

    public void setAttachments(List<AttachmentVo> attachments) {
        this.attachments = attachments;
    }

    public boolean isHaveLike() {
        return haveLike;
    }

    public void setHaveLike(boolean haveLike) {
        this.haveLike = haveLike;
    }
}
```

---

## 1.4 é™„ä»¶è¡¨

```sql
create table attachment
(
    file_id         varchar(15)   not null comment 'æ–‡ä»¶id'
        primary key,
    article_id      varchar(15)   not null comment 'æ–‡ç« id',
    user_id         varchar(15)   not null comment 'ç”¨æˆ·id',
    file_size       bigint        not null comment 'æ–‡ä»¶å¤§å°',
    filename        varchar(200)  not null comment 'æ–‡ä»¶å',
    download_count  int default 0 null comment 'ä¸‹è½½æ¬¡æ•°',
    filepath        varchar(100)  not null comment 'æ–‡ä»¶è·¯å¾„',
    filetype        tinyint       not null comment 'æ–‡ä»¶ç±»å‹',
    download_points int           not null comment 'ä¸‹è½½æ‰€éœ€ç§¯åˆ†'
)
    comment 'é™„ä»¶è¡¨';

create index attachment_article_id_index
    on attachment (article_id)
    comment 'æ–‡ç« idç´¢å¼•';

create index attachment_user_id_index
    on attachment (user_id)
    comment 'ç”¨æˆ·idç´¢å¼•';
```

å¿«é€Ÿå®Œæˆé™„ä»¶è¡¨CRUDã€‚

---

### 1.4.1 æŸ¥è¯¢æ–‡ç« é™„ä»¶

æŸ¥è¯¢æ–‡ç« è¯¦æƒ…éœ€è¦æŸ¥è¯¢æ–‡ç« çš„é™„ä»¶ï¼Œé¦–å…ˆå®šä¹‰ä¸€ä¸ªæŸ¥çœ‹æ–‡ç« é™„ä»¶çš„æ¥å£ï¼Œé€šè¿‡æ–‡ç« idå’Œä½œè€…æŸ¥è¯¢ï¼Œsqlå¦‚ä¸‹ï¼š

```xml
<!-- é€šè¿‡æ–‡ç« idå’Œä½œè€…æŸ¥è¯¢ -->
<select id="selectByArticleIdAndUserId" resultType="com.ling.entity.po.Attachment">
    select <include refid="commonField"/> from attachment
    where article_id = #{articleId} and user_id = #{userId}
</select>
```

è¿™ä¸ªæ¥å£è¿”å›çš„æ˜¯ä¸€ä¸ªé›†åˆï¼ŒåŸå› ä¸Šé¢è¯´è¿‡ä¸€ä¸ªæ–‡ç« å¯èƒ½æœ‰å¤šä¸ªé™„ä»¶ã€‚

å®ç°è¿™ä¸ªæ¥å£ï¼š

```java
@Override
public List<AttachmentVo> findByArticleIdAndUserId(String articleId, String userId) {
    List<Attachment> attachments = attachmentMapper.selectByArticleIdAndUserId(articleId, userId);
    List<AttachmentVo> attachmentVos = attachments.stream().map(e -> {
        AttachmentVo attachmentVo = new AttachmentVo();
        BeanUtils.copyProperties(e, attachmentVo);
        return attachmentVo;
    }).collect(Collectors.toList());
    return attachmentVos;
}
```

---

## 1.5 ç‚¹èµè¡¨

è®°å½•ç”¨æˆ·ç»™æ–‡ç« ç‚¹èµçš„æƒ…å†µï¼Œæˆ–è€…ç»™è¯„è®ºç‚¹èµçš„æƒ…å†µã€‚æ¯ä¸ªäººï¼Œæ¯ç¯‡æ–‡ç« æˆ–è¯„è®ºåªèƒ½ç‚¹èµä¸€æ¬¡ï¼š

```sql
create table like_recode
(
    like_recode_id   int auto_increment comment 'è®°å½•id'
        primary key,
    target_id        varchar(15) not null comment 'ç›®æ ‡id, æ–‡ç« æˆ–è¯„è®º',
    target_author_id varchar(15) not null comment 'ç›®æ ‡ä½œè€…id',
    liker_id         varchar(15) not null comment 'ç‚¹èµäººid',
    like_type        tinyint     not null comment 'ç‚¹èµç±»å‹, 0: æ–‡ç« ç‚¹èµ, 1: è¯„è®ºç‚¹èµ',
    like_time        datetime    not null comment 'ç‚¹èµæ—¶é—´',
    constraint like_recode_pk2
        unique (target_id, liker_id, like_type)
)
    comment 'ç‚¹èµè®°å½•è¡¨';

create index like_recode_liker_id_like_type_target_id_index
    on like_recode (liker_id, like_type, target_id);
```

`target_id`åŒæ—¶è®°å½•æ–‡ç« idå’Œè¯„è®ºidï¼Œç”¨`like_type`æ¥åŒºåˆ†æ–‡ç« å’Œè¯„è®ºã€‚

ç‚¹è¿‡èµåï¼Œé‡å¤ç‚¹èµä¸ä¼šå¢åŠ ç‚¹èµæ¬¡æ•°ï¼Œç›¸åº”çš„ç‚¹èµè®°å½•è¡¨ä¸­ä¹Ÿåªä¼šå­˜åœ¨ä¸€æ¡æ•°æ®ã€‚å¯ä»¥é€šè¿‡å‰ç«¯æ§åˆ¶ï¼Œä¸è®©è¯·æ±‚å‘é€åˆ°åç«¯ã€‚

---

### 1.5.1 ç»„åˆç´¢å¼•

å‡è®¾å­—æ®µaã€bã€cå»ºç«‹ç»„åˆç´¢å¼•ï¼Œè¿™3ä¸ªå­—æ®µæ˜¯å¦èµ°ç´¢å¼•æ ¹æ®**æœ€å·¦å‰ç¼€åŸåˆ™**æ¥åˆ¤æ–­ï¼Œå…·ä½“è§„åˆ™å¦‚ä¸‹ï¼š

- ä½¿ç”¨aã€bã€cä¸ºæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œèµ°ç´¢å¼•ã€‚
- ä½¿ç”¨aã€bä¸ºæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œèµ°ç´¢å¼•ã€‚
- ä½¿ç”¨aä¸ºæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œèµ°ç´¢å¼•ã€‚
- ä½¿ç”¨bã€cä¸ºæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œä¸èµ°ç´¢å¼•ã€‚
- ä½¿ç”¨aã€cä¸ºæ¡ä»¶æŸ¥è¯¢æ—¶ï¼Œaçš„éƒ¨åˆ†èµ°ç´¢å¼•ï¼Œcçš„éƒ¨åˆ†ä¸èµ°ç´¢å¼•ã€‚

æœ€å·¦å‰ç¼€æŒ‡çš„æ˜¯å»ºç«‹ç»„åˆç´¢å¼•æœ€å·¦è¾¹çš„å­—æ®µï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå­—æ®µã€‚è¿™é‡Œæ˜¯aï¼Œè”åˆç´¢å¼•æ˜¯æŒ‰ç…§ç´¢å¼•å­—æ®µä»å·¦åˆ°å³æ’åºçš„ï¼Œæ‰€ä»¥ç´¢å¼•å¯ä»¥ç”¨äºåŒ¹é…ä»å·¦åˆ°å³çš„å­—æ®µé¡ºåºã€‚

> âš æ³¨æ„ï¼š
>
> è¿™ä¸ªåŒ¹é…æ˜¯è¿ç»­çš„ã€‚

æ‰€ä»¥ä½¿ç”¨ä»aå¼€å§‹çš„ï¼Œè¿ç»­çš„å­—æ®µä¸ºæ¡ä»¶çš„æŸ¥è¯¢æ˜¯èµ°ç´¢å¼•çš„ã€‚åƒbã€cå°±æ˜¯è·³è¿‡äº†aå¼€å§‹ï¼Œè¿åäº†æœ€å·¦å‰ç¼€ï¼Œå› æ­¤ä¸èµ°ç´¢å¼•ã€‚åƒaã€cè™½ç„¶ä»aå¼€å§‹ï¼Œä½†æ˜¯ä¸è¿ç»­ï¼Œå› æ­¤åªæœ‰açš„éƒ¨åˆ†èµ°ç´¢å¼•ï¼Œcçš„éƒ¨åˆ†ä¸èµ°ç´¢å¼•ã€‚

æ€»ç»“ï¼š

- ä»æœ€å·¦å­—æ®µå¼€å§‹ï¼Œè¿ç»­çš„å­—æ®µèµ°ç´¢å¼•ã€‚
- ä¸æ˜¯ä»æœ€å·¦å­—æ®µå¼€å§‹ï¼Œä¸èµ°ç´¢å¼•ã€‚
- index(a, b, c, d)ï¼Œä½¿ç”¨a, b, dï¼Œé‚£ä¹ˆä»…a, bèµ°ç´¢å¼•ã€‚

---

### 1.5.2 æŸ¥è¯¢ç‚¹èµè®°å½•

é€šè¿‡ç›®æ ‡idã€ç‚¹ä½œè€…ä»¥åŠç‚¹èµç±»å‹æŸ¥è¯¢ï¼Œæ ¹æ®æŸ¥è¯¢ç»“æœåˆ¤æ–­å½“å‰ç™»å½•äººæœ‰æ²¡æœ‰ç»™æ–‡ç« æˆ–è€…è¯„è®ºç‚¹èµã€‚

æŸ¥è¯¢sqlï¼š

```xml
<!-- é€šè¿‡ç›®æ ‡idã€ç‚¹èµäººã€ç‚¹èµç±»å‹æŸ¥è¯¢ -->
<select id="selectByTargetIdAndLikerIdAndLikeType" resultType="com.ling.entity.po.LikeRecode">
    select <include refid="commonField"/> from like_recode
    where target_id = #{targetId} and
    liker_id = #{likerId} and
    like_type = #{likeType}
</select>
```

---

## 1.6 ğŸŒæŸ¥è¯¢æ–‡ç« è¯¦æƒ…æ¥å£

åœ°å€ï¼š

```
http://localhost:8091/web/articles/{articlesId}
```

è¯·æ±‚æ–¹å¼ï¼š

`GET`

è¯·æ±‚å‚æ•°ï¼š

| å‚æ•°å    | ç±»å‹     | å¿…å¡«é¡¹ | è¯´æ˜   |
| --------- | -------- | ------ | ------ |
| articleId | `string` | `true` | æ–‡ç« id |

å“åº”ï¼š

```json
{
    "status": "success",
    "code": 200,
    "msg": "è¯·æ±‚æˆåŠŸ",
    "data": {
        "article": {
            "articleId": "uukicbc29eqo",
            "boardId": 3,
            "boardName": "æ¸¸æˆæ”»ç•¥",
            "pBoardId": 1,
            "pBoardName": "æ¸¸æˆ",
            "userId": "9619980088",
            "nickName": "ling",
            "userIdAddress": "å››å·çœ",
            "title": "å·«å¸ˆ3æ”»ç•¥1",
            "cover": null,
            "content": "è¿™æ˜¯htmlå†…å®¹",
            "mdContent": null,
            "editorType": null,
            "summary": "å·«å¸ˆ3è‰¯å¿ƒæ”»ç•¥",
            "readCount": 12,
            "likeCount": 1,
            "topType": 1,
            "attachmentType": 1,
            "status": 2,
            "createTime": "2025-01-06 16:38:14",
            "commentCount": 0
        },
        "attachments": [
            {
                "fileId": "wdpqowjdpq",
                "filename": "å·«å¸ˆ3æ”»ç•¥.pdf",
                "filesize": null,
                "filetype": 1,
                "downloadCount": 0,
                "downloadPoints": 3
            }
        ],
        "haveLike": false
    }
}
```

---

## 1.7 æ¥å£å®ç°

- æŸ¥è¯¢æ–‡ç« è¿”å›`null`ï¼Œå¯èƒ½å­˜åœ¨ç”¨æˆ·è¾“å…¥é”™è¯¯æ–‡ç« idçš„æƒ…å†µï¼ŒæŠ›å‡º404å¼‚å¸¸ã€‚
- æŒ‰ç…§ä¸Šé¢åˆ†æçš„æ–‡ç« çŠ¶æ€å¯¹ä¸åŒç™»å½•æƒ…å†µè¿›è¡Œé™åˆ¶ï¼Œä¸æ»¡è¶³æŠ›å‡º404å¼‚å¸¸ã€‚
- èƒ½è®¿é—®çš„æ–‡ç« å°±éœ€è¦å¢åŠ æ–‡ç« çš„æµè§ˆé‡ï¼Œä½†æ˜¯ä¸€å®šæ˜¯ç™»å½•ç”¨æˆ·è®¿é—®å·²å®¡æ ¸çš„æ–‡ç« æ‰èƒ½å¢åŠ ã€‚
- æ–‡ç« å¯èƒ½æœ‰é™„ä»¶ï¼Œå› æ­¤è¦æŸ¥è¯¢é™„ä»¶è¡¨ã€‚
- ç”¨æˆ·å¯èƒ½ç»™æ–‡ç« ç‚¹èµï¼Œè¦è¿›è¡Œåˆ¤æ–­ã€‚
- æ¥å£è¿”å›`ArticleDetailVo`ã€‚

æ§åˆ¶å™¨ï¼š

```java
/**
     * æ´»æœŸæ–‡ç« è¯¦æƒ…
     *
     * @param session
     * @param articleId
     * @return
     */
    @GetMapping("/{articleId}")
    @AccessControl
    public Result<ArticleDetailVo> getArticleDetails(HttpSession session, @PathVariable @Validation String articleId) {
        UserInfoSessionDto userInfo = (UserInfoSessionDto) session.getAttribute(Constant.USERINFO_SESSION_KEY);
        ArticleDetailVo articleDetailVo = articleService.articleDetail(userInfo, articleId);
        return Result.success(articleDetailVo);
    }
```

æ¥å£å®ç°ï¼š

```java
/**
     * æ–‡ç« è¯¦æƒ…
     *
     * @param userinfo
     * @param articleId
     * @return
     */
    @Override
    @Transactional(rollbackFor = Exception.class)
    public ArticleDetailVo articleDetail(UserInfoSessionDto userinfo, String articleId) {
        ArticleVo articleVo = findById(articleId);
        if (Objects.isNull(articleVo))
            throw new BusinessException(ResponseCodeEnum.CODE_404);
        // ä¸èƒ½è®¿é—®å·²åˆ é™¤æ–‡ç« 
        boolean isDeleted = articleVo.getStatus().equals(ArticleStatusEnum.DELETED.getStatus());
        if (isDeleted)
            throw new BusinessException(ResponseCodeEnum.CODE_404);

        boolean isLogin = Objects.nonNull(userinfo);
        boolean isPending = articleVo.getStatus().equals(ArticleStatusEnum.PENDING.getStatus());
        // æœªç™»å½•ä¸èƒ½è®¿é—®å¾…å®¡æ ¸æ–‡ç« 
        if (!isLogin && isPending)
            throw new BusinessException(ResponseCodeEnum.CODE_404);

        boolean isAuthor = isLogin && articleVo.getUserId().equals(userinfo.getUserId());
        // éç®¡ç†å‘˜ç™»å½•ï¼Œä¸èƒ½è®¿é—®å¾…å®¡æ ¸æ–‡ç« ï¼Œé™¤éæ˜¯ä½œè€…æœ¬äºº
        if (isLogin && !userinfo.getIsAdmin() && isPending && !isAuthor)
            throw new BusinessException(ResponseCodeEnum.CODE_404);

        boolean isAudited = articleVo.getStatus().equals(ArticleStatusEnum.AUDITED.getStatus());
        // ç™»å½•ç”¨æˆ·è®¿é—®å·²å®¡æ ¸æ–‡ç« æ‰å¢åŠ é˜…è¯»é‡
        if (isLogin && isAudited) articleMapper.incrementReadCount(articleId);

        ArticleDetailVo articleDetailVo = new ArticleDetailVo();
        articleDetailVo.setArticle(articleVo);

        if (Objects.equals(articleVo.getAttachmentType(), AttachmentTypeEnum.HAVE_ATTACHMENT.getType())) {
            List<AttachmentVo> attachmentVos = attachmentService.findVoByArticleIdAndUserId(articleVo.getArticleId(), articleVo.getUserId());
            articleDetailVo.setAttachments(attachmentVos);
        }
        // ç™»å½•ç”¨æˆ·æ‰åˆ¤æ–­æœ‰æ²¡æœ‰å¯¹æ–‡ç« ç‚¹èµ
        if (isLogin) {
            LikeRecode likeRecode = likeRecodeService.findByTargetIdAndLikerIdAndLikeType(articleVo.getArticleId(), userinfo.getUserId(), 0);
            articleDetailVo.setHaveLike(likeRecode != null);
        }
        return articleDetailVo;
    }
```

æ›´æ–°é˜…è¯»é‡çš„sqlï¼š

```xml
<!-- æ›´æ–°é˜…è¯»é‡ -->
<update id="incrementReadCount">
    update article set read_count = read_count + 1 where article_id = #{articleId}
</update>
```
