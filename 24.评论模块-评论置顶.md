# 1 è¯„è®ºç½®é¡¶

## 1.1 ğŸŒæ¥å£è¯¦æƒ…

åœ°å€ï¼š

```swift
localhost:8091/web/comments/top?commentId=?&topType=?
```

æ–¹å¼ï¼š

`PUT`

è¯·æ±‚å‚æ•°ï¼š

| å‚æ•°å    | ç±»å‹  | å¿…å¡«é¡¹ | è¯´æ˜               |
| --------- | ----- | ------ | ------------------ |
| commentId | `int` | `true` | è¯„è®ºid             |
| topType   | `int` | `true` | 0: æœªç½®é¡¶ï¼Œ1: ç½®é¡¶ |

å“åº”ï¼š

```json
{
    "status": "success",
    "code": 200,
    "msg": "è¯·æ±‚æˆåŠŸ",
    "data": null
}
```

---

## 1.2 æ¥å£å®ç°

æ ¹æ®`top_type`å€’å™æ’åºæ¥å®ç°ç½®é¡¶æ’åºã€‚å˜æ›´`top_type`å­—æ®µå˜æ›´ä¸º0æˆ–1ï¼Œ0è¡¨ç¤ºæœªç½®é¡¶ï¼Œ1è¡¨ç¤ºç½®é¡¶ã€‚

è¯„è®ºç½®é¡¶çš„é™åˆ¶æ¡ä»¶å¦‚ä¸‹ï¼š

- åªæœ‰å½“å‰æ–‡ç« çš„ä½œè€…æ‰èƒ½ç½®é¡¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ¤æ–­å½“å‰ç”¨æˆ·æ˜¯å¦ä¸ºä½œè€…ã€‚
- åªæœ‰1çº§è¯„è®ºèƒ½ç½®é¡¶ã€‚

**æ³¨æ„**ï¼šå¤„ç†è¯„è®ºç½®é¡¶æˆ–å–æ¶ˆç½®é¡¶æ“ä½œæ—¶ï¼Œè‹¥ç›®æ ‡è¯„è®ºå·²å¤„äºç›®æ ‡çŠ¶æ€ï¼ˆå³å·²ç½®é¡¶æˆ–æœªç½®é¡¶ï¼‰ï¼Œæˆ‘ä»¬åº”è¯¥ç›´æ¥ä¸­æ–­æ“ä½œï¼Œå› ä¸ºé‡å¤æ‰§è¡Œç›¸åŒçŠ¶æ€çš„æ“ä½œä¸ä»…æ— æ³•äº§ç”Ÿå®é™…æ•ˆæœï¼Œåè€Œä¼šå¯¼è‡´ä¸å¿…è¦çš„æ•°æ®åº“æ›´æ–°æ“ä½œï¼Œä»è€Œå¢åŠ ç³»ç»Ÿè´Ÿè½½ï¼Œé™ä½æ•´ä½“è¿è¡Œæ•ˆç‡ã€‚

å®ç°å¦‚ä¸‹ï¼š

ä¸šåŠ¡å±‚ï¼š

```java
/**
     * å¤„ç†è¯„è®ºç½®é¡¶
     *
     * @param userInfo
     * @param commentId
     * @param topType
     */
    void processCommentTop(UserInfoSessionDto userInfo, Integer commentId, Integer topType);
```

```java
/**
     * å¤„ç†è¯„è®ºç½®é¡¶
     *
     * @param userInfo
     * @param commentId
     * @param topType
     */
    @Override
    public void processCommentTop(UserInfoSessionDto userInfo, Integer commentId, Integer topType) {
        CommentQueryDto commentQueryDto = new CommentQueryDto();
        commentQueryDto.setCommentId(commentId);
        commentQueryDto.setAdmin(userInfo.getIsAdmin());
        commentQueryDto.setUserId(userInfo.getUserId());
        List<Comment> comments = commentMapper.selectByCondition(commentQueryDto);
        // æ£€æŸ¥è¯„è®ºæ˜¯å¦å­˜åœ¨
        if (Objects.isNull(comments) || comments.isEmpty())
            throw new BusinessException(CommonMsg.COMMENT_NOT_EXISTS);
        // 2çº§è¯„è®ºä¸èƒ½ç½®é¡¶
        if (!Objects.equals(comments.get(0).getpCommentId(), Constant.NUM_0))
            throw new BusinessException(ResponseCodeEnum.CODE_600);
        String articleId = comments.get(0).getArticleId();
        Article article = articleMapper.selectById(articleId);
        // åªæœ‰ä½œè€…æ‰èƒ½ç½®é¡¶
        if (!Objects.equals(article.getUserId(), userInfo.getUserId()))
            throw new BusinessException(CommonMsg.ONLY_AUTHOR_TOP_COMMENT);
        // è‹¥æ›´æ–°ç½®é¡¶çŠ¶æ€ä¸å½“å‰ç½®é¡¶çŠ¶æ€ä¸€è‡´ï¼Œç›´æ¥ä¸­æ–­ï¼Œé¿å…é‡å¤æ“ä½œ
        if (Objects.equals(comments.get(0).getTopType(), topType))
            return;
        Comment comment = new Comment();
        comment.setCommentId(commentId);
        comment.setTopType(topType);
        edit(comment);
    }
```

æ§åˆ¶å™¨å±‚ï¼š

```java
/**
     * è¯„è®ºç½®é¡¶æ¥å£
     *
     * @param session
     * @param commentId
     * @param topType
     * @return
     */
    @PutMapping("/top")
    @AccessControl(loginRequired = true)
    public Result<Void> commentTopHandle(HttpSession session, @Validation Integer commentId,
                                         @Validation(max = 1) Integer topType) {
        UserInfoSessionDto userInfo = (UserInfoSessionDto) session.getAttribute(Constant.USERINFO_SESSION_KEY);
        commentService.processCommentTop(userInfo, commentId, topType);
        return Result.success();
    }
```



